import{r as c,j as e}from"./index-B8Dyeey_.js";import{f}from"./currency-EbIO-V_7.js";import{P as x,A as g,H as R,F as S,a as B}from"./index-CMzQl4t4.js";import"./enhancedSettings-Cd0HS9If.js";function k(){const[s,j]=c.useState("health"),[l,m]=c.useState(null),[A,h]=c.useState(!1),[u,b]=c.useState(null),y=c.useCallback(n=>{h(!0),b(null);try{const r=JSON.parse(localStorage.getItem("cattalytics:animals")||"[]"),i=JSON.parse(localStorage.getItem("cattalytics:finance")||"[]");let d={};if(n==="health")d={type:"health",summary:{totalAnimals:r.length,vaccinatedAnimals:r.filter(a=>a.lastVaccination).length,animalsUnderTreatment:r.filter(a=>a.healthAlerts&&a.healthAlerts.length>0).length,vaccineOverdue:r.filter(a=>{if(!a.lastVaccination)return!0;const t=new Date(a.lastVaccination),p=new Date(new Date().setFullYear(new Date().getFullYear()-1));return t<p}).length},animals:r.map(a=>({id:a.id,name:a.name,breed:a.breed,age:a.dob?new Date().getFullYear()-new Date(a.dob).getFullYear():"Unknown",status:a.status,lastVaccination:a.lastVaccination||"Never"}))};else if(n==="breeding"){const o=r.filter(t=>t.sex==="F"),a=o.filter(t=>t.pregnancyStatus==="Pregnant"||t.pregnancyStatus==="Recently Bred");d={type:"breeding",summary:{totalFemales:o.length,pregnantAnimals:o.filter(t=>t.pregnancyStatus==="Pregnant").length,readyToBreed:o.filter(t=>t.pregnancyStatus==="Ready to Breed").length},animals:a.map(t=>({id:t.id,name:t.name,breed:t.breed,pregnancyStatus:t.pregnancyStatus,expectedDue:t.expectedDue||"Unknown",daysPregnant:t.expectedDue?Math.floor((new Date(t.expectedDue)-new Date)/(1e3*60*60*24)):0}))}}else if(n==="feed"){const o=i.filter(t=>t.category==="Feed"||t.type==="expense"&&!t.category),a=o.reduce((t,p)=>t+Math.abs(p.amount||0),0);d={type:"feed",summary:{totalAnimals:r.length,totalFeedCost:a,avgCostPerAnimal:r.length>0?(a/r.length).toFixed(2):0,recentExpenses:o.length},expenses:o.slice(-20).map(t=>({date:t.date,amount:t.amount,subcategory:t.subcategory||t.category,description:t.description,vendor:t.vendor||"N/A"}))}}m(d)}catch(r){console.error("Error generating report:",r),b(r.message),m(null)}h(!1)},[]);c.useEffect(()=>{y(s)},[s,y]);const v=async()=>{if(l)try{const n=s==="health"?"Herd Health Report":s==="breeding"?"Breeding Report":"Feed Cost Analysis",r=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),i=[new x({text:"JR FARM",heading:R.HEADING_1,alignment:g.CENTER,spacing:{after:100}}),new x({text:n,alignment:g.CENTER,spacing:{after:50}}),new x({text:`Date: ${r}`,alignment:g.CENTER,spacing:{after:300}})];Object.entries(l.summary||{}).forEach(([p,w])=>{i.push(new x({text:`${p}: ${w}`,spacing:{after:100}}))});const d=new S({sections:[{children:i}]}),o=await B.toBlob(d),a=URL.createObjectURL(o),t=document.createElement("a");t.href=a,t.download=`${s}_report_${r}.docx`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)}catch(n){alert("Error downloading report: "+n.message)}};return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto",padding:"20px"},children:[e.jsx("h2",{children:"ðŸ“Š Additional Reports"}),u&&e.jsxs("div",{style:{background:"#fee2e2",color:"#991b1b",padding:"12px",borderRadius:"6px",marginBottom:"20px"},children:["Error: ",u]}),e.jsx("div",{style:{display:"flex",gap:"12px",marginBottom:"20px",borderBottom:"2px solid #e5e7eb"},children:[{id:"health",label:"ðŸ¥ Herd Health"},{id:"breeding",label:"ðŸ‘¶ Breeding"},{id:"feed",label:"ðŸŒ¾ Feed Analysis"}].map(n=>e.jsx("button",{onClick:()=>j(n.id),style:{padding:"10px 20px",background:"none",border:"none",borderBottom:s===n.id?"3px solid #059669":"3px solid transparent",cursor:"pointer",fontWeight:s===n.id?"600":"400",color:s===n.id?"#059669":"#666",marginBottom:"-2px"},children:n.label},n.id))}),A?e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#666"},children:e.jsxs("div",{style:{fontSize:"18px"},children:["â³ Loading ",s," report..."]})}):l?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"20px",gap:"10px"},children:e.jsx("button",{onClick:v,style:{padding:"10px 20px",background:"#059669",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"ðŸ“¥ Download DOCX"})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",marginBottom:"30px"},children:Object.entries(l.summary||{}).map(([n,r])=>e.jsxs("div",{style:{background:"#f9fafb",padding:"16px",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#666",fontWeight:"600",marginBottom:"8px",textTransform:"capitalize"},children:n.replace(/([A-Z])/g," $1")}),e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#059669"},children:typeof r=="number"&&n.includes("Cost")?f(r):r})]},n))}),l.animals&&l.animals.length>0&&e.jsxs("div",{style:{background:"#f9fafb",padding:"20px",borderRadius:"8px",border:"1px solid #e5e7eb",overflowX:"auto"},children:[e.jsx("h3",{style:{marginTop:0},children:s==="health"?"ðŸ„ Animal Health Status":"ðŸ‘¶ Breeding Animals"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#e5e7eb"},children:Object.keys(l.animals[0]||{}).map(n=>e.jsx("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #d1d5db"},children:n.replace(/([A-Z])/g," $1")},n))})}),e.jsx("tbody",{children:l.animals.slice(0,50).map((n,r)=>e.jsx("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:Object.values(n).map((i,d)=>e.jsx("td",{style:{padding:"10px"},children:i},d))},r))})]})]}),l.expenses&&l.expenses.length>0&&e.jsxs("div",{style:{background:"#f9fafb",padding:"20px",borderRadius:"8px",border:"1px solid #e5e7eb",overflowX:"auto",marginTop:"20px"},children:[e.jsx("h3",{style:{marginTop:0},children:"ðŸŒ¾ Feed Expenses"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#e5e7eb"},children:[e.jsx("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #d1d5db"},children:"Date"}),e.jsx("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #d1d5db"},children:"Amount"}),e.jsx("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #d1d5db"},children:"Category"}),e.jsx("th",{style:{padding:"10px",textAlign:"left",borderBottom:"2px solid #d1d5db"},children:"Description"})]})}),e.jsx("tbody",{children:l.expenses.map((n,r)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"10px"},children:n.date}),e.jsx("td",{style:{padding:"10px",color:"#ef4444",fontWeight:"600"},children:f(n.amount)}),e.jsx("td",{style:{padding:"10px"},children:n.subcategory}),e.jsx("td",{style:{padding:"10px",fontSize:"12px"},children:n.description})]},r))})]})]})]}):e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#666"},children:e.jsx("div",{style:{fontSize:"18px"},children:"No data available"})})]})}export{k as default};
