import{r as d,u as S,v as w,j as e,w as f,A as g,E as A,x as C,y as z,z as L,B as E}from"./index-B8Dyeey_.js";function T(){const[u,j]=d.useState([]),[l,y]=d.useState(null),[s,o]=d.useState({action:"",entityType:"",userId:"",startDate:"",endDate:""}),[c,x]=d.useState("");d.useEffect(()=>{p()},[s]);function p(){const t=S(s);j(t),y(w())}function m(){const t=z(),i=new Blob([t],{type:"text/csv"}),r=URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=`audit-log-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}function b(){const t=L(),i=JSON.stringify(t,null,2),r=new Blob([i],{type:"application/json"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download=`audit-log-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}function v(){if(!f("manage_users")){alert("Permission denied");return}if(confirm("Are you sure you want to clear the entire audit log? This cannot be undone!")){const t=E();t.success?(p(),alert("Audit log cleared")):alert(t.error)}}const h=u.filter(t=>{if(!c)return!0;const i=c.toLowerCase();return t.userName.toLowerCase().includes(i)||t.action.toLowerCase().includes(i)||t.entityType.toLowerCase().includes(i)||t.entityId.toLowerCase().includes(i)});return e.jsxs("section",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,flexWrap:"wrap",gap:8},children:[e.jsx("h2",{style:{margin:0},children:"ðŸ“‹ Audit Log"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:m,style:{fontSize:12},children:"ðŸ“Š Export CSV"}),e.jsx("button",{onClick:b,style:{fontSize:12},children:"ðŸ“„ Export JSON"}),f("manage_users")&&e.jsx("button",{onClick:v,style:{fontSize:12,background:"#dc2626",color:"white"},children:"ðŸ—‘ï¸ Clear Log"})]})]}),l&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginBottom:24},children:[e.jsxs("div",{className:"card",style:{padding:16,background:"#eff6ff"},children:[e.jsx("div",{style:{fontSize:12,color:"#666",marginBottom:4},children:"Total Entries"}),e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#2563eb"},children:l.total})]}),e.jsxs("div",{className:"card",style:{padding:16,background:"#fef3c7"},children:[e.jsx("div",{style:{fontSize:12,color:"#666",marginBottom:4},children:"Last 24 Hours"}),e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#f59e0b"},children:l.last24Hours})]}),e.jsxs("div",{className:"card",style:{padding:16,background:"#f0fdf4"},children:[e.jsx("div",{style:{fontSize:12,color:"#666",marginBottom:4},children:"Last 7 Days"}),e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#059669"},children:l.lastWeek})]}),e.jsxs("div",{className:"card",style:{padding:16,background:"#fee2e2"},children:[e.jsx("div",{style:{fontSize:12,color:"#666",marginBottom:4},children:"Delete Actions"}),e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#dc2626"},children:l.byAction[g.DELETE]||0})]})]}),e.jsx("div",{className:"card",style:{padding:16,marginBottom:20},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:13,marginBottom:4},children:"Search"}),e.jsx("input",{type:"text",placeholder:"Search user, action, entity...",value:c,onChange:t=>x(t.target.value),style:{width:"100%",padding:8}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:13,marginBottom:4},children:"Action"}),e.jsxs("select",{value:s.action,onChange:t=>o({...s,action:t.target.value}),style:{width:"100%",padding:8},children:[e.jsx("option",{value:"",children:"All Actions"}),Object.values(g).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:13,marginBottom:4},children:"Entity Type"}),e.jsxs("select",{value:s.entityType,onChange:t=>o({...s,entityType:t.target.value}),style:{width:"100%",padding:8},children:[e.jsx("option",{value:"",children:"All Entities"}),Object.values(A).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:13,marginBottom:4},children:"Start Date"}),e.jsx("input",{type:"date",value:s.startDate,onChange:t=>o({...s,startDate:t.target.value}),style:{width:"100%",padding:8}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:13,marginBottom:4},children:"End Date"}),e.jsx("input",{type:"date",value:s.endDate,onChange:t=>o({...s,endDate:t.target.value}),style:{width:"100%",padding:8}})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:e.jsx("button",{onClick:()=>{o({action:"",entityType:"",userId:"",startDate:"",endDate:""}),x("")},style:{width:"100%",padding:8},children:"Clear Filters"})})]})}),e.jsx("div",{className:"card",style:{padding:0,overflow:"auto"},children:e.jsxs("table",{style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Timestamp"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Entity"}),e.jsx("th",{children:"Entity ID"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:40,color:"#999"},children:"No audit entries found"})}):h.map(t=>{const i=C(t);return e.jsxs("tr",{children:[e.jsx("td",{style:{whiteSpace:"nowrap",fontSize:13},children:i.time}),e.jsx("td",{style:{fontWeight:600},children:i.user}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:"4px",fontSize:12,background:t.userRole==="MANAGER"?"#dbeafe":"#f3f4f6",color:t.userRole==="MANAGER"?"#1e40af":"#374151"},children:i.role})}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:"4px",fontSize:12,background:t.action==="delete"?"#fee2e2":t.action==="create"?"#dcfce7":t.action==="update"?"#fef3c7":"#f3f4f6",color:t.action==="delete"?"#991b1b":t.action==="create"?"#166534":t.action==="update"?"#92400e":"#374151"},children:t.action})}),e.jsx("td",{style:{fontSize:13},children:t.entityType}),e.jsx("td",{style:{fontSize:13,fontFamily:"monospace"},children:t.entityId}),e.jsx("td",{style:{fontSize:12,color:"#666"},children:t.details&&Object.keys(t.details).length>0?e.jsxs("details",{children:[e.jsx("summary",{style:{cursor:"pointer"},children:"View"}),e.jsx("pre",{style:{margin:"8px 0 0 0",fontSize:11,background:"#f9fafb",padding:8,borderRadius:4,overflow:"auto"},children:JSON.stringify(t.details,null,2)})]}):"N/A"})]},t.id)})})]})}),e.jsxs("div",{style:{marginTop:16,fontSize:13,color:"#666",textAlign:"center"},children:["Showing ",h.length," of ",u.length," entries"]})]})}export{T as default};
