function u(){try{const t=localStorage.getItem("cattalytics:inventory");return t?JSON.parse(t):[]}catch{return[]}}function y(){return u().filter(n=>n.category==="Veterinary"||n.category==="Supplements"||n.subcategory==="Medicine"||n.subcategory==="Vaccines"||n.subcategory==="Dewormer")}function m(t,n,o="",e=""){try{const r=u().map(i=>{if(i.id===t){const c=(i.quantity||0)-n,l={date:new Date().toISOString(),quantity:n,usedBy:o,purpose:e,remainingQuantity:Math.max(0,c)};return{...i,quantity:Math.max(0,c),usageHistory:[...i.usageHistory||[],l],lastUsed:new Date().toISOString()}}return i});localStorage.setItem("cattalytics:inventory",JSON.stringify(r));const s=r.find(i=>i.id===t);return s&&s.quantity<=(s.reorderPoint||0)&&g("LOW_STOCK",`${s.name} is below reorder point. Current: ${s.quantity} ${s.unit}`,"HIGH"),{success:!0,item:s}}catch(a){return console.error("Failed to update inventory:",a),{success:!1,error:a.message}}}function f(t){try{const n=JSON.parse(localStorage.getItem("cattalytics:finance")||"[]"),o={id:"F-"+Date.now(),date:t.date||new Date().toISOString().slice(0,10),amount:-Math.abs(parseFloat(t.amount)),type:"expense",category:t.category||"Other",subcategory:t.subcategory||"Miscellaneous",description:t.description||"",notes:t.notes||[],paymentMethod:t.paymentMethod||"Cash",vendor:t.vendor||"",source:t.source||"Manual",linkedId:t.linkedId||"",autoRecorded:!0,createdAt:new Date().toISOString()};return n.push(o),localStorage.setItem("cattalytics:finance",JSON.stringify(n)),{success:!0,expense:o}}catch(n){return console.error("Failed to record expense:",n),{success:!1,error:n.message}}}function h(t){try{const n=JSON.parse(localStorage.getItem("cattalytics:finance")||"[]"),o={id:"F-"+Date.now(),date:t.date||new Date().toISOString().slice(0,10),amount:Math.abs(parseFloat(t.amount)),type:"income",category:t.category||"Other",subcategory:t.subcategory||"Miscellaneous",description:t.description||"",notes:t.notes||[],paymentMethod:t.paymentMethod||"Cash",vendor:t.vendor||"",source:t.source||"Manual",linkedId:t.linkedId||"",autoRecorded:!0,createdAt:new Date().toISOString()};return n.push(o),localStorage.setItem("cattalytics:finance",JSON.stringify(n)),{success:!0,income:o}}catch(n){return console.error("Failed to record income:",n),{success:!1,error:n.message}}}function g(t,n,o="MEDIUM"){try{const e=JSON.parse(localStorage.getItem("devinsfarm:notifications")||"[]"),a={id:"NOTIF-"+Date.now(),type:t,message:n,priority:o,read:!1,timestamp:new Date().toISOString()};return e.unshift(a),e.length>100&&e.splice(100),localStorage.setItem("devinsfarm:notifications",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("newNotification")),a}catch(e){return console.error("Failed to create notification:",e),null}}function p(){try{const t=JSON.parse(localStorage.getItem("cattalytics:finance")||"[]"),n={};let o=0,e=0;return t.forEach(r=>{const s=r.source||"Manual";n[s]||(n[s]={income:0,expenses:0,net:0}),r.type==="income"?(n[s].income+=r.amount,o+=r.amount):(n[s].expenses+=Math.abs(r.amount),e+=Math.abs(r.amount)),n[s].net=n[s].income-n[s].expenses}),{sources:Object.keys(n).map(r=>({source:r,income:n[r].income,expenses:n[r].expenses,net:n[r].net})),totalIncome:o,totalExpenses:e,netProfit:o-e}}catch(t){return console.error("Failed to get financial summary:",t),{sources:[],totalIncome:0,totalExpenses:0,netProfit:0}}}function d(){try{const t=localStorage.getItem("cattalytics:pets");return t?JSON.parse(t):[]}catch{return[]}}function S(){try{const t=d(),n=[],o=new Date;return o.setHours(0,0,0,0),t.forEach(e=>{if(e.vaccinations&&e.vaccinations.length>0&&e.vaccinations.forEach(a=>{if(a.nextDue){const r=new Date(a.nextDue);r.setHours(0,0,0,0);const s=Math.ceil((r-o)/(1e3*60*60*24));s>=0&&s<=30&&n.push({id:`pet-vac-${e.id}-${a.vaccineName}`,title:`${a.vaccineName} vaccination due for ${e.name}`,description:`${e.species} vaccination due on ${a.nextDue}`,dueDate:a.nextDue,priority:s<=7?"HIGH":"MEDIUM",category:"Pet Care",subcategory:"Vaccination",status:"pending",source:"PetManagement",linkedId:e.id,petName:e.name})}}),e.medications&&e.medications.length>0&&e.medications.forEach(a=>{const r=new Date(a.endDate);r.setHours(0,0,0,0),r>=o&&n.push({id:`pet-med-${e.id}-${a.name}`,title:`Give ${a.name} to ${e.name}`,description:`Dosage: ${a.dosage}, Frequency: ${a.frequency}`,dueDate:new Date().toISOString().slice(0,10),priority:"HIGH",category:"Pet Care",subcategory:"Medication",status:"pending",recurring:a.frequency,source:"PetManagement",linkedId:e.id,petName:e.name})}),e.groomingLog&&e.groomingLog.length>0){const a=e.groomingLog.sort((i,c)=>new Date(c.date)-new Date(i.date))[0],r=new Date(a.date),s=Math.ceil((o-r)/(1e3*60*60*24));s>=60&&n.push({id:`pet-groom-${e.id}`,title:`Grooming due for ${e.name}`,description:`Last groomed ${s} days ago`,dueDate:new Date().toISOString().slice(0,10),priority:"LOW",category:"Pet Care",subcategory:"Grooming",status:"pending",source:"PetManagement",linkedId:e.id,petName:e.name})}}),n}catch(t){return console.error("Failed to get pet tasks:",t),[]}}function D(){try{const t=d(),n=[];return t.forEach(o=>{o.feedingSchedule&&o.feedingSchedule.times&&o.feedingSchedule.times.split(",").map(a=>a.trim()).forEach(a=>{n.push({id:`pet-feed-${o.id}-${a}`,title:`Feed ${o.name}`,description:`${o.feedingSchedule.foodType}, ${o.feedingSchedule.portion}`,time:a,frequency:"daily",category:"Pet Care",subcategory:"Feeding",source:"PetManagement",linkedId:o.id,petName:o.name})}),o.healthRecords&&o.healthRecords.length>0&&o.healthRecords.forEach(e=>{if(e.followUpDate){const a=new Date(e.followUpDate),r=new Date;r.setHours(0,0,0,0),a>=r&&n.push({id:`pet-vet-${o.id}-${e.date}`,title:`Vet follow-up for ${o.name}`,description:`Follow-up: ${e.diagnosis||"Checkup"}`,date:e.followUpDate,time:"09:00",category:"Pet Care",subcategory:"Veterinary",source:"PetManagement",linkedId:o.id,petName:o.name})}}),o.breedingRecords&&o.breedingRecords.length>0&&o.breedingRecords.forEach(e=>{if(e.expectedBirthDate){const a=new Date(e.expectedBirthDate),r=new Date;r.setHours(0,0,0,0),a>=r&&n.push({id:`pet-birth-${o.id}-${e.breedingDate}`,title:`Expected birth for ${o.name}`,description:`Partner: ${e.partner||"Unknown"}`,date:e.expectedBirthDate,category:"Pet Care",subcategory:"Breeding",source:"PetManagement",linkedId:o.id,petName:o.name})}})}),n}catch(t){return console.error("Failed to get pet schedules:",t),[]}}export{y as a,f as b,S as c,D as d,p as g,h as r,m as u};
