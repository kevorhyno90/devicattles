import{i as E,g as M,a as D,e as x,w as J,d as y,s as v,b as P,o as R,c as N}from"./vendor-firebase-DPzZ0AXH.js";const b={apiKey:"AIzaSyC3ZH_roI3O4e8O0TEcLbgJCuVI64t8b4c",authDomain:"devinsfarm-2025.firebaseapp.com",projectId:"devinsfarm-2025",storageBucket:"devinsfarm-2025.firebasestorage.app",messagingSenderId:"603947883430",appId:"1:603947883430:web:ac52cd8333bc7603c14d67",measurementId:"G-T8H86QB318"};function h(){return b.apiKey!=="YOUR_API_KEY"&&b.projectId!=="YOUR_PROJECT_ID"}let S=null,l=null,u=null;try{h()?(S=E(b),l=M(S),u=D(S),x(l).catch(e=>{e.code==="failed-precondition"?console.warn("Firebase persistence failed: Multiple tabs open"):e.code==="unimplemented"&&console.warn("Firebase persistence not available in this browser")}),console.log("âœ… Firebase initialized successfully")):window.__firebaseConfigLogged||(console.info("â„¹ï¸ Firebase not configured. Running in local-only mode."),window.__firebaseConfigLogged=!0)}catch(e){console.error("âŒ Firebase initialization error:",e)}let d=!1,i="offline",I=[];function A(){return h()?(d=localStorage.getItem("devinsfarm:sync:enabled")==="true",d&&u.currentUser&&(console.log("âœ… Sync initialized for user:",u.currentUser.uid),w()),d):(i="disabled",!1)}function U(e){d=e,localStorage.setItem("devinsfarm:sync:enabled",e.toString()),e&&u.currentUser?w():O()}function g(){return d&&h()&&u.currentUser!==null}function _(){return i}function p(){return u.currentUser?`users/${u.currentUser.uid}`:null}async function C(e,t){if(!g())return!1;try{i="syncing";const n=p();if(!n)return!1;const r=y(l,n,e);return await N(r,{data:t,updatedAt:v(),version:1},{merge:!0}),i="synced",console.log(`âœ… Synced ${e} to Firebase`),!0}catch(n){return console.error(`âŒ Error syncing ${e}:`,n),i="error",!1}}function w(){if(!g())return;const e=["animals","transactions","inventory","tasks","crops","treatments","feeding","breeding","measurements","milkYield","groups","pastures","schedules","calves","azolla","bsf","reminders","notifications"],t=p();t&&(O(),e.forEach(n=>{const r=y(l,t,n),o=R(r,s=>{if(s.exists()){const a=s.data(),c=`devinsfarm:${n}`,m=localStorage.getItem(c),f=JSON.stringify(a.data);m!==f&&(localStorage.setItem(c,f),console.log(`ðŸ”„ Updated ${n} from Firebase`),window.dispatchEvent(new StorageEvent("storage",{key:c,newValue:f,url:window.location.href})))}},s=>{console.error(`âŒ Error in ${n} listener:`,s)});I.push(o)}),console.log("âœ… Real-time sync listeners started"))}function O(){I.forEach(e=>e()),I=[],console.log("â¹ï¸ Real-time sync listeners stopped")}async function z(){if(!g())return!1;try{i="syncing";const e={animals:localStorage.getItem("devinsfarm:animals"),transactions:localStorage.getItem("devinsfarm:transactions"),inventory:localStorage.getItem("devinsfarm:inventory"),tasks:localStorage.getItem("devinsfarm:tasks"),crops:localStorage.getItem("devinsfarm:crops"),treatments:localStorage.getItem("devinsfarm:treatments"),feeding:localStorage.getItem("devinsfarm:feeding"),breeding:localStorage.getItem("devinsfarm:breeding"),measurements:localStorage.getItem("devinsfarm:measurements"),milkYield:localStorage.getItem("devinsfarm:milkYield"),groups:localStorage.getItem("devinsfarm:groups"),pastures:localStorage.getItem("devinsfarm:pastures"),schedules:localStorage.getItem("devinsfarm:schedules"),calves:localStorage.getItem("cattalytics:calf:management"),azolla:localStorage.getItem("cattalytics:azolla:ponds"),bsf:localStorage.getItem("cattalytics:bsf:colonies"),reminders:localStorage.getItem("devinsfarm:reminders"),notifications:localStorage.getItem("devinsfarm:notifications")},t=p();if(!t)return!1;const n=J(l);let r=0;for(const[o,s]of Object.entries(e))if(s){const a=y(l,t,o);n.set(a,{data:JSON.parse(s),updatedAt:v(),version:1},{merge:!0}),r++}return await n.commit(),i="synced",console.log(`âœ… Pushed ${r} collections to Firebase`),!0}catch(e){return console.error("âŒ Error pushing to Firebase:",e),i="error",!1}}async function T(){if(!g())return!1;try{i="syncing";const e=p();if(!e)return!1;const t=["animals","transactions","inventory","tasks","crops","treatments","feeding","breeding","measurements","milkYield","groups","pastures","schedules","calves","azolla","bsf","reminders","notifications"];let n=0;for(const r of t){const o=y(l,e,r),s=await P(o);if(s.exists()){const a=s.data(),c=r.startsWith("cattalytics:")?r:`devinsfarm:${r}`;localStorage.setItem(c,JSON.stringify(a.data)),n++}}return i="synced",console.log(`âœ… Pulled ${n} collections from Firebase`),window.location.reload(),!0}catch(e){return console.error("âŒ Error pulling from Firebase:",e),i="error",!1}}function Y(){if(!g())return;const e=localStorage.setItem;localStorage.setItem=function(t,n){if(e.call(localStorage,t,n),t.startsWith("devinsfarm:")||t.startsWith("cattalytics:")){const r=t.replace("devinsfarm:","").replace("cattalytics:","");try{const o=JSON.parse(n);C(r,o)}catch{}}}}function F(){try{const e=localStorage.getItem("cattalytics:inventory");return e?JSON.parse(e):[]}catch{return[]}}function H(){return F().filter(t=>t.category==="Veterinary"||t.category==="Supplements"||t.subcategory==="Medicine"||t.subcategory==="Vaccines"||t.subcategory==="Dewormer")}function K(e,t,n="",r=""){try{const s=F().map(c=>{if(c.id===e){const m=(c.quantity||0)-t,f={date:new Date().toISOString(),quantity:t,usedBy:n,purpose:r,remainingQuantity:Math.max(0,m)};return{...c,quantity:Math.max(0,m),usageHistory:[...c.usageHistory||[],f],lastUsed:new Date().toISOString()}}return c});localStorage.setItem("cattalytics:inventory",JSON.stringify(s));const a=s.find(c=>c.id===e);return a&&a.quantity<=(a.reorderPoint||0)&&$("LOW_STOCK",`${a.name} is below reorder point. Current: ${a.quantity} ${a.unit}`,"HIGH"),{success:!0,item:a}}catch(o){return console.error("Failed to update inventory:",o),{success:!1,error:o.message}}}function L(e){try{const t=JSON.parse(localStorage.getItem("cattalytics:finance")||"[]"),n={id:"F-"+Date.now(),date:e.date||new Date().toISOString().slice(0,10),amount:-Math.abs(parseFloat(e.amount)),type:"expense",category:e.category||"Other",subcategory:e.subcategory||"Miscellaneous",description:e.description||"",notes:e.notes||[],paymentMethod:e.paymentMethod||"Cash",vendor:e.vendor||"",source:e.source||"Manual",linkedId:e.linkedId||"",autoRecorded:!0,createdAt:new Date().toISOString()};return t.push(n),localStorage.setItem("cattalytics:finance",JSON.stringify(t)),{success:!0,expense:n}}catch(t){return console.error("Failed to record expense:",t),{success:!1,error:t.message}}}function V(e){try{const t=JSON.parse(localStorage.getItem("cattalytics:finance")||"[]"),n={id:"F-"+Date.now(),date:e.date||new Date().toISOString().slice(0,10),amount:Math.abs(parseFloat(e.amount)),type:"income",category:e.category||"Other",subcategory:e.subcategory||"Miscellaneous",description:e.description||"",notes:e.notes||[],paymentMethod:e.paymentMethod||"Cash",vendor:e.vendor||"",source:e.source||"Manual",linkedId:e.linkedId||"",autoRecorded:!0,createdAt:new Date().toISOString()};return t.push(n),localStorage.setItem("cattalytics:finance",JSON.stringify(t)),{success:!0,income:n}}catch(t){return console.error("Failed to record income:",t),{success:!1,error:t.message}}}function $(e,t,n="MEDIUM"){try{const r=JSON.parse(localStorage.getItem("devinsfarm:notifications")||"[]"),o={id:"NOTIF-"+Date.now(),type:e,message:t,priority:n,read:!1,timestamp:new Date().toISOString()};return r.unshift(o),r.length>100&&r.splice(100),localStorage.setItem("devinsfarm:notifications",JSON.stringify(r)),window.dispatchEvent(new CustomEvent("newNotification")),o}catch(r){return console.error("Failed to create notification:",r),null}}function j(){try{const e=JSON.parse(localStorage.getItem("cattalytics:finance")||"[]"),t={bySource:{},totalIncome:0,totalExpenses:0,netProfit:0};return e.forEach(n=>{const r=n.source||"Manual";t.bySource[r]||(t.bySource[r]={income:0,expenses:0,net:0}),n.type==="income"?(t.bySource[r].income+=n.amount,t.totalIncome+=n.amount):(t.bySource[r].expenses+=Math.abs(n.amount),t.totalExpenses+=Math.abs(n.amount)),t.bySource[r].net=t.bySource[r].income-t.bySource[r].expenses}),t.netProfit=t.totalIncome-t.totalExpenses,t}catch(e){return console.error("Failed to get financial summary:",e),{bySource:{},totalIncome:0,totalExpenses:0,netProfit:0}}}export{H as a,L as b,u as c,h as d,g as e,_ as f,j as g,U as h,A as i,T as j,z as p,V as r,Y as s,K as u};
