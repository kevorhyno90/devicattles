import{r as g,j as e}from"./index-CeDgDi5r.js";import{d as F}from"./lib-core-XQuPJE47.js";import{g as M}from"./lib-integration-BX7JWOcy.js";import"./vendor-react-CqO7gtIP.js";import"./lib-export-Dp5-osfT.js";import"./lib-notifications-DRlqN2Ug.js";import"./vendor-firebase-DPzZ0AXH.js";function K({onNavigate:t}){const[u,N]=g.useState(null),[D,S]=g.useState(!0),[C,W]=g.useState("month"),[y,z]=g.useState(!0);g.useEffect(()=>{if(v(),y){const s=setInterval(v,6e4);return()=>clearInterval(s)}},[C,y]);const v=()=>{S(!0);try{const s=F(),n=M()||{bySource:{},totalIncome:0,totalExpenses:0,netProfit:0};n.sources=Object.entries(n.bySource||{}).map(([a,x])=>({source:a,...x})),N({...s,integratedFinance:n})}catch(s){console.error("Error loading dashboard:",s),N({...F(),integratedFinance:{bySource:{},totalIncome:0,totalExpenses:0,netProfit:0,sources:[]}})}S(!1)};if(D||!u)return e.jsx("div",{className:"loading",children:"Loading dashboard..."});const{animals:h,breeding:m,health:r,tasks:l,finance:T,feedCosts:i,inventory:d,milkProduction:f,integratedFinance:p}=u,j=p.totalIncome+T.income,k=p.totalExpenses+T.expenses,c=j-k,b=j>0?c/j*100:0;return e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h1",{children:"ðŸ“Š Farm Dashboard"}),e.jsxs("div",{className:"dashboard-controls",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:y,onChange:s=>z(s.target.checked)}),"Auto-refresh"]}),e.jsx("button",{onClick:v,className:"btn-secondary",children:"ðŸ”„ Refresh"})]})]}),typeof window<"u"&&window.installPWA&&e.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"16px 20px",borderRadius:8,marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:16,fontWeight:"bold",marginBottom:4},children:"ðŸ“± Install Devins Farm App"}),e.jsx("div",{style:{fontSize:13,opacity:.9},children:"Access the farm management system offline from your home screen"})]}),e.jsx("button",{onClick:async()=>{await window.installPWA?.()&&v()},style:{background:"white",color:"#667eea",border:"none",padding:"10px 20px",borderRadius:6,cursor:"pointer",fontSize:14,fontWeight:600,whiteSpace:"nowrap"},children:"Install Now"})]}),typeof window<"u"&&"serviceWorker"in navigator&&e.jsxs("div",{style:{background:navigator.serviceWorker.controller?"#ecfdf5":"#fef3c7",color:navigator.serviceWorker.controller?"#065f46":"#92400e",padding:"8px 12px",borderRadius:6,marginBottom:16,fontSize:13,display:"flex",alignItems:"center",gap:8},children:[navigator.serviceWorker.controller?"âœ…":"âš ï¸",navigator.serviceWorker.controller?"App is ready to work offline":"Offline mode not available - refresh page to activate"]}),(l.overdue>0||r.totalAlerts>0||d.criticalStock>0)&&e.jsxs("div",{className:"alert-bar urgent",children:[e.jsx("strong",{children:"âš ï¸ Attention Required:"}),l.overdue>0&&e.jsxs("span",{children:[" ",l.overdue," overdue task(s)"]}),r.totalAlerts>0&&e.jsxs("span",{children:[" â€¢ ",r.totalAlerts," health alert(s)"]}),d.criticalStock>0&&e.jsxs("span",{children:[" â€¢ ",d.criticalStock," critical inventory item(s)"]})]}),e.jsxs("div",{className:"kpi-grid",children:[e.jsxs("div",{className:"kpi-card",onClick:()=>t&&t("animals"),children:[e.jsx("div",{className:"kpi-icon",children:"ðŸ„"}),e.jsxs("div",{className:"kpi-content",children:[e.jsx("h3",{children:"Total Animals"}),e.jsx("div",{className:"kpi-value",children:h.total}),e.jsx("div",{className:"kpi-details",children:Object.entries(h.byType).map(([s,n])=>e.jsxs("div",{className:"kpi-detail-item",children:[e.jsxs("span",{children:[s,":"]})," ",e.jsx("strong",{children:n})]},s))})]})]}),e.jsxs("div",{className:"kpi-card",onClick:()=>t&&t("tasks"),children:[e.jsx("div",{className:"kpi-icon",children:"âœ…"}),e.jsxs("div",{className:"kpi-content",children:[e.jsx("h3",{children:"Tasks"}),e.jsx("div",{className:"kpi-value",children:l.inProgress+l.pending}),e.jsx("div",{className:"kpi-subtitle",children:"Active"}),e.jsxs("div",{className:"kpi-details",children:[e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Due Today:"})," ",e.jsx("strong",{className:l.dueToday>0?"text-warning":"",children:l.dueToday})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"This Week:"})," ",e.jsx("strong",{children:l.dueThisWeek})]}),l.overdue>0&&e.jsxs("div",{className:"kpi-detail-item text-danger",children:[e.jsx("span",{children:"Overdue:"})," ",e.jsx("strong",{children:l.overdue})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Completion:"})," ",e.jsxs("strong",{children:[l.completionRate,"%"]})]})]})]})]}),e.jsxs("div",{className:"kpi-card",onClick:()=>t&&t("finance"),children:[e.jsx("div",{className:"kpi-icon",children:"ðŸ’°"}),e.jsxs("div",{className:"kpi-content",children:[e.jsx("h3",{children:"Total Finance"}),e.jsxs("div",{className:"kpi-value",style:{color:c>=0?"#10b981":"#ef4444",fontSize:"28px"},children:["KES ",c.toLocaleString("en-KE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("div",{className:"kpi-subtitle",children:"Net Profit/Loss"}),e.jsxs("div",{className:"kpi-details",children:[e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Total Income:"})," ",e.jsxs("strong",{className:"text-success",children:["KES ",j.toFixed(2)]})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Total Expenses:"})," ",e.jsxs("strong",{className:"text-danger",children:["KES ",k.toFixed(2)]})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Profit Margin:"})," ",e.jsxs("strong",{style:{color:b>=0?"#10b981":"#ef4444"},children:[b.toFixed(1),"%"]})]})]})]})]}),e.jsxs("div",{className:"kpi-card",onClick:()=>t&&t("health"),children:[e.jsx("div",{className:"kpi-icon",children:"ðŸ¥"}),e.jsxs("div",{className:"kpi-content",children:[e.jsx("h3",{children:"Health Status"}),e.jsx("div",{className:"kpi-value",style:{color:r.totalAlerts>0?"#f59e0b":"#10b981"},children:r.totalAlerts}),e.jsx("div",{className:"kpi-subtitle",children:"Alerts"}),e.jsxs("div",{className:"kpi-details",children:[e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Under Treatment:"})," ",e.jsx("strong",{children:r.underTreatment})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Due Treatments:"})," ",e.jsx("strong",{className:r.dueTreatments>0?"text-warning":"",children:r.dueTreatments})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Needs Vaccination:"})," ",e.jsx("strong",{children:r.needsVaccination})]})]})]})]})]}),p&&p.sources&&p.sources.length>0&&e.jsxs("div",{className:"card",style:{padding:"20px",marginTop:"24px"},children:[e.jsx("h3",{style:{margin:"0 0 20px 0",fontSize:"20px",display:"flex",alignItems:"center",gap:"8px"},children:"ðŸ’° Income & Expense Breakdown by Source"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px",marginBottom:"20px"},children:p.sources.map(s=>e.jsxs("div",{style:{padding:"16px",background:s.net>=0?"#f0fdf4":"#fef2f2",borderRadius:"12px",border:`2px solid ${s.net>=0?"#86efac":"#fca5a5"}`,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[e.jsx("div",{style:{fontWeight:"700",fontSize:"16px",marginBottom:"12px",color:"#1f2937"},children:s.source}),e.jsxs("div",{style:{display:"grid",gap:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"14px"},children:[e.jsx("span",{style:{color:"#6b7280"},children:"Income:"}),e.jsxs("span",{style:{color:"#15803d",fontWeight:"600"},children:["+KES ",s.income.toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"14px"},children:[e.jsx("span",{style:{color:"#6b7280"},children:"Expenses:"}),e.jsxs("span",{style:{color:"#dc2626",fontWeight:"600"},children:["-KES ",s.expenses.toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"16px",borderTop:"1px solid #e5e7eb",paddingTop:"8px",marginTop:"4px"},children:[e.jsx("span",{style:{fontWeight:"600",color:"#374151"},children:"Net:"}),e.jsxs("span",{style:{fontWeight:"700",fontSize:"18px",color:s.net>=0?"#059669":"#dc2626"},children:[s.net>=0?"+":"","KES ",s.net.toFixed(2)]})]})]})]},s.source))}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px",marginTop:"20px",paddingTop:"20px",borderTop:"2px solid #e5e7eb"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"16px",background:"#ecfdf5",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"8px"},children:"Total Income"}),e.jsxs("div",{style:{fontSize:"28px",fontWeight:"700",color:"#15803d"},children:["KES ",j.toFixed(2)]})]}),e.jsxs("div",{style:{textAlign:"center",padding:"16px",background:"#fef2f2",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"8px"},children:"Total Expenses"}),e.jsxs("div",{style:{fontSize:"28px",fontWeight:"700",color:"#dc2626"},children:["KES ",k.toFixed(2)]})]}),e.jsxs("div",{style:{textAlign:"center",padding:"16px",background:c>=0?"#f0fdf4":"#fef2f2",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"8px"},children:"Net Profit/Loss"}),e.jsxs("div",{style:{fontSize:"28px",fontWeight:"700",color:c>=0?"#059669":"#dc2626"},children:[c>=0?"+":"","KES ",c.toFixed(2)]}),e.jsxs("div",{style:{fontSize:"12px",color:"#6b7280",marginTop:"4px"},children:["Margin: ",b.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"kpi-grid",children:[e.jsxs("div",{className:"kpi-card",onClick:()=>t&&t("breeding"),children:[e.jsx("div",{className:"kpi-icon",children:"ðŸ¤°"}),e.jsxs("div",{className:"kpi-content",children:[e.jsx("h3",{children:"Breeding"}),e.jsx("div",{className:"kpi-value",children:m.totalPregnant}),e.jsx("div",{className:"kpi-subtitle",children:"Pregnant"}),e.jsxs("div",{className:"kpi-details",children:[e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Due Next Month:"})," ",e.jsx("strong",{children:m.dueNextMonth})]}),m.overdue>0&&e.jsxs("div",{className:"kpi-detail-item text-danger",children:[e.jsx("span",{children:"Overdue:"})," ",e.jsx("strong",{children:m.overdue})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Success Rate:"})," ",e.jsxs("strong",{children:[m.successRate,"%"]})]})]})]})]}),e.jsxs("div",{className:"kpi-card",onClick:()=>t&&t("inventory"),children:[e.jsx("div",{className:"kpi-icon",children:"ðŸ“¦"}),e.jsxs("div",{className:"kpi-content",children:[e.jsx("h3",{children:"Inventory"}),e.jsx("div",{className:"kpi-value",style:{color:d.totalAlerts>0?"#f59e0b":"#10b981"},children:d.totalAlerts}),e.jsx("div",{className:"kpi-subtitle",children:"Alerts"}),e.jsxs("div",{className:"kpi-details",children:[d.criticalStock>0&&e.jsxs("div",{className:"kpi-detail-item text-danger",children:[e.jsx("span",{children:"Critical:"})," ",e.jsx("strong",{children:d.criticalStock})]}),e.jsxs("div",{className:"kpi-detail-item text-warning",children:[e.jsx("span",{children:"Low Stock:"})," ",e.jsx("strong",{children:d.lowStock})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Out of Stock:"})," ",e.jsx("strong",{children:d.outOfStock})]})]})]})]}),f.totalMilk>0&&e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:"ðŸ¥›"}),e.jsxs("div",{className:"kpi-content",children:[e.jsx("h3",{children:"Milk Production"}),e.jsx("div",{className:"kpi-value",children:f.totalMilk.toFixed(1)}),e.jsx("div",{className:"kpi-subtitle",children:"Liters (This Month)"}),e.jsxs("div",{className:"kpi-details",children:[e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Avg Daily:"})," ",e.jsxs("strong",{children:[f.avgDaily.toFixed(1)," L"]})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Producing:"})," ",e.jsxs("strong",{children:[f.producingAnimals," animals"]})]})]})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:"ðŸŒ¾"}),e.jsxs("div",{className:"kpi-content",children:[e.jsx("h3",{children:"Feed Costs"}),e.jsxs("div",{className:"kpi-value",style:{color:i.trend==="increasing"?"#ef4444":i.trend==="decreasing"?"#10b981":"#3b82f6"},children:["$",i.avgMonthly?i.avgMonthly.toFixed(0):"0"]}),e.jsx("div",{className:"kpi-subtitle",children:"Monthly Average"}),e.jsxs("div",{className:"kpi-details",children:[e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Last 6 Months:"})," ",e.jsxs("strong",{children:["$",i.totalCost?i.totalCost.toLocaleString():"0"]})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Trend:"}),e.jsxs("strong",{style:{color:i.trend==="increasing"?"#ef4444":i.trend==="decreasing"?"#10b981":"#6b7280"},children:[i.trend==="increasing"?"ðŸ“ˆ ":i.trend==="decreasing"?"ðŸ“‰ ":"âž¡ï¸ ",i.trend||"stable",i.trendPercent?` (${i.trendPercent}%)`:""]})]}),e.jsxs("div",{className:"kpi-detail-item",children:[e.jsx("span",{children:"Per Animal/Day:"}),e.jsxs("strong",{children:["$",h.total>0&&i.avgMonthly?(i.avgMonthly/30/h.total).toFixed(2):"0.00"]})]})]})]})]})]}),i.monthlyData&&i.monthlyData.length>0&&e.jsxs("div",{className:"chart-container",style:{marginTop:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h3",{children:"ðŸ“ˆ Feed Cost Analysis"}),e.jsxs("div",{style:{fontSize:12,color:"#666"},children:[e.jsxs("span",{style:{marginRight:12},children:[e.jsx("strong",{children:"Total Transactions:"})," ",i.monthlyData.reduce((s,n)=>s+(n.count||0),0)]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Avg per Month:"})," $",i.avgMonthly?i.avgMonthly.toFixed(0):"0"]})]})]}),e.jsxs("div",{className:"bar-chart",style:{display:"flex",alignItems:"flex-end",justifyContent:"space-around",height:280,gap:8,padding:"16px 0",borderBottom:"2px solid #333",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:32,width:50,display:"flex",flexDirection:"column",justifyContent:"space-between",fontSize:10,color:"#666",paddingRight:8,textAlign:"right"},children:(()=>{const s=Math.max(...i.monthlyData.map(n=>n.amount||0),1);return[s,s*.75,s*.5,s*.25,0].map((n,a)=>e.jsxs("div",{children:["$",n.toFixed(0)]},a))})()}),e.jsx("div",{style:{display:"flex",flex:1,alignItems:"flex-end",justifyContent:"space-around",gap:8,marginLeft:60},children:i.monthlyData.map((s,n)=>{const a=Math.max(...i.monthlyData.map(o=>o.amount||0),1),x=a>0?(s.amount||0)/a*100:0,w=s.amount===a&&a>0,A=s.amount===Math.min(...i.monthlyData.map(o=>o.amount||0));return e.jsxs("div",{className:"bar-chart-item",style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},title:`${s.month}: $${(s.amount||0).toFixed(2)} (${s.count||0} transactions)`,children:[e.jsx("div",{className:"bar-chart-bar",style:{height:`${x}%`,minHeight:x>0?"4px":"0",width:"100%",background:w?"linear-gradient(180deg, #ef4444 0%, #dc2626 100%)":A&&s.amount>0?"linear-gradient(180deg, #10b981 0%, #059669 100%)":"linear-gradient(180deg, #3b82f6 0%, #2563eb 100%)",borderRadius:"4px 4px 0 0",position:"relative",transition:"all 0.3s ease",cursor:"pointer",boxShadow:"0 -2px 4px rgba(0,0,0,0.1)"},onMouseEnter:o=>{o.currentTarget.style.transform="scaleY(1.05)",o.currentTarget.style.opacity="0.8"},onMouseLeave:o=>{o.currentTarget.style.transform="scaleY(1)",o.currentTarget.style.opacity="1"},children:x>15&&e.jsxs("span",{className:"bar-chart-value",style:{position:"absolute",top:-20,left:"50%",transform:"translateX(-50%)",fontSize:10,fontWeight:"bold",color:"#111",whiteSpace:"nowrap",background:"rgba(255,255,255,0.9)",padding:"2px 4px",borderRadius:3,border:"1px solid #ddd"},children:["$",(s.amount||0).toFixed(0)]})}),e.jsx("div",{className:"bar-chart-label",style:{marginTop:8,fontSize:10,color:"#666",textAlign:"center",fontWeight:w||A?"bold":"normal"},children:s.month}),(s.count||0)>0&&e.jsxs("div",{style:{fontSize:9,color:"#999",marginTop:2},children:[s.count," tx"]})]},n)})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12,marginTop:16,padding:12,background:"#f9fafb",borderRadius:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:4},children:"Highest Month"}),e.jsx("div",{style:{fontSize:14,fontWeight:"bold",color:"#ef4444"},children:(()=>{const s=i.monthlyData.reduce((n,a)=>a.amount>n.amount?a:n,i.monthlyData[0]);return`${s.month}: $${(s.amount||0).toFixed(0)}`})()})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:4},children:"Lowest Month"}),e.jsx("div",{style:{fontSize:14,fontWeight:"bold",color:"#10b981"},children:(()=>{const s=i.monthlyData.reduce((n,a)=>a.amount<n.amount?a:n,i.monthlyData[0]);return`${s.month}: $${(s.amount||0).toFixed(0)}`})()})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:4},children:"Cost per Animal (Monthly)"}),e.jsxs("div",{style:{fontSize:14,fontWeight:"bold",color:"#3b82f6"},children:["$",h.total>0&&i.avgMonthly?(i.avgMonthly/h.total).toFixed(2):"0.00"]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:4},children:"Projected Next Month"}),e.jsxs("div",{style:{fontSize:14,fontWeight:"bold",color:"#6366f1"},children:["$",(()=>{if(i.monthlyData.length<2)return i.avgMonthly?i.avgMonthly.toFixed(0):"0";const s=i.monthlyData.slice(-3);return(s.reduce((a,x)=>a+(x.amount||0),0)/s.length).toFixed(0)})()]})]})]})]}),e.jsxs("div",{className:"quick-actions",children:[e.jsx("h3",{children:"âš¡ Quick Actions"}),e.jsxs("div",{className:"quick-actions-grid",children:[e.jsx("button",{onClick:()=>t&&t("animals"),className:"btn-primary",children:"âž• Add Animal"}),e.jsx("button",{onClick:()=>t&&t("tasks"),className:"btn-primary",children:"ðŸ“ New Task"}),e.jsx("button",{onClick:()=>t&&t("finance"),className:"btn-primary",children:"ðŸ’³ Add Transaction"}),e.jsx("button",{onClick:()=>t&&t("inventory"),className:"btn-primary",children:"ðŸ“¦ Update Inventory"})]})]}),e.jsx("div",{className:"dashboard-footer",children:e.jsxs("small",{children:["Last updated: ",new Date(u.lastUpdated).toLocaleString()]})})]})}export{K as default};
