import{r as l,j as e}from"./index-CeDgDi5r.js";import{e as U,a as Y,c as X,i as Q,f as Z}from"./lib-export-Dp5-osfT.js";import{g as ee}from"./lib-integration-BX7JWOcy.js";import"./vendor-react-CqO7gtIP.js";import"./lib-core-XQuPJE47.js";import"./lib-notifications-DRlqN2Ug.js";import"./vendor-firebase-DPzZ0AXH.js";const te=[{id:"F-001",date:"2025-01-12",amount:-18e3,type:"expense",category:"Veterinary",subcategory:"Vaccines",description:"Annual vaccination program",notes:[],paymentMethod:"M-Pesa",vendor:"Valley Veterinary Clinic"},{id:"F-002",date:"2025-01-15",amount:-36825,type:"expense",category:"Feed",subcategory:"Hay",description:"Premium alfalfa hay - 50 bales",notes:[],paymentMethod:"Bank Transfer",vendor:"Green Valley Feed"},{id:"F-003",date:"2025-01-20",amount:187500,type:"income",category:"Milk Sales",subcategory:"Wholesale",description:"Weekly milk delivery to processing plant",notes:[],paymentMethod:"Bank Transfer",vendor:"Dairy Processors Inc"},{id:"F-004",date:"2025-01-22",amount:-13499,type:"expense",category:"Equipment",subcategory:"Maintenance",description:"Milking equipment parts replacement",notes:[],paymentMethod:"M-Pesa",vendor:"Farm Equipment Supply"}],W=[{name:"Feed",subcategories:["Hay","Grain","Supplements","Pasture Seed"]},{name:"Veterinary",subcategories:["Vaccines","Treatment","Checkups","Emergency Care"]},{name:"Equipment",subcategories:["Purchase","Maintenance","Repair","Fuel"]},{name:"Labor",subcategories:["Wages","Benefits","Contract Work","Training"]},{name:"Utilities",subcategories:["Electricity","Water","Internet","Phone"]},{name:"Insurance",subcategories:["Liability","Equipment","Livestock","Property"]},{name:"Transportation",subcategories:["Fuel","Vehicle Maintenance","Delivery","Travel"]},{name:"Other",subcategories:["Supplies","Professional Services","Miscellaneous"]}],O=[{name:"Milk Sales",subcategories:["Wholesale","Direct Sales","Farmers Market"]},{name:"Livestock Sales",subcategories:["Cattle Sales","Breeding Stock","Calf Sales"]},{name:"Crop Sales",subcategories:["Hay","Grain","Silage"]},{name:"Services",subcategories:["Custom Work","Consulting","Equipment Rental"]},{name:"Government",subcategories:["Subsidies","Grants","Tax Credits"]},{name:"Other",subcategories:["Investment Income","Insurance Claims","Miscellaneous"]}],ne=["Cash","M-Pesa","Bank Transfer","Credit Card","Debit Card","Check"];function xe(){const E="cattalytics:finance",[s,c]=l.useState([]),[ie,se]=l.useState("all"),[k,m]=l.useState(!1),[I,u]=l.useState(null),[g,f]=l.useState(null),[j,M]=l.useState("all"),[v,F]=l.useState("all"),[p,b]=l.useState({start:"",end:""}),[i,r]=l.useState({amount:"",type:"expense",category:"Feed",subcategory:"Hay",description:"",paymentMethod:"Cash",vendor:"",date:new Date().toISOString().slice(0,10)}),T=l.useRef(null);function P(){U(s,"finance_transactions.csv")}function z(){Y(s,"finance_transactions.csv")}function A(){X(s,"finance_transactions.json")}function L(){T.current?.click()}function K(t){const n=t.target.files?.[0];if(!n)return;const o=n.name.split(".").pop()?.toLowerCase();o==="json"?Q(n,(d,h)=>{if(h){alert("Import failed: "+h.message);return}confirm(`Import ${d.length} transactions? This will merge with existing data.`)&&(c([...s,...d]),alert(`Imported ${d.length} transactions`))}):o==="csv"?Z(n,(d,h)=>{if(h){alert("Import failed: "+h.message);return}if(confirm(`Import ${d.length} transactions? This will merge with existing data.`)){const B=d.map(y=>({...y,amount:parseFloat(y.amount)||0,notes:y.notes?JSON.parse(y.notes):[]}));c([...s,...B]),alert(`Imported ${B.length} transactions`)}}):alert("Unsupported file type. Use CSV or JSON."),t.target.value=""}l.useEffect(()=>{const t=localStorage.getItem(E);c(t?JSON.parse(t):te)},[]),l.useEffect(()=>localStorage.setItem(E,JSON.stringify(s)),[s]);function V(){const t=parseFloat(i.amount||0);if(!i.description.trim()||!t)return;const n=i.type==="expense"?-Math.abs(t):Math.abs(t),d={id:"F-"+Math.floor(1e3+Math.random()*9e3),...i,amount:n,description:i.description.trim(),notes:[],createdDate:new Date().toISOString()};c([...s,d]),r({amount:"",type:"expense",category:"Feed",subcategory:"Hay",description:"",paymentMethod:"Cash",vendor:"",date:new Date().toISOString().slice(0,10)}),m(!1)}function R(t){confirm("Delete financial entry "+t+"?")&&c(s.filter(n=>n.id!==t))}function H(t,n){n.trim()&&c(s.map(o=>o.id===t?{...o,notes:[...o.notes||[],{id:Date.now(),text:n.trim(),date:new Date().toISOString(),author:"Current User"}]}:o))}function D(t){r({amount:Math.abs(t.amount).toString(),type:t.type,category:t.category,subcategory:t.subcategory||"",description:t.description||"",paymentMethod:t.paymentMethod||"Cash",vendor:t.vendor||"",date:t.date||new Date().toISOString().slice(0,10)}),f(t.id),m(!0)}function J(){const t=parseFloat(i.amount||0);if(!i.description.trim()||!t)return;const n=i.type==="expense"?-Math.abs(t):Math.abs(t);c(s.map(o=>o.id===g?{...o,...i,amount:n,description:i.description.trim()}:o)),r({amount:"",type:"expense",category:"Feed",subcategory:"Hay",description:"",paymentMethod:"Cash",vendor:"",date:new Date().toISOString().slice(0,10)}),f(null),m(!1)}function G(){r({amount:"",type:"expense",category:"Feed",subcategory:"Hay",description:"",paymentMethod:"Cash",vendor:"",date:new Date().toISOString().slice(0,10)}),f(null),m(!1)}const $=s.filter(t=>!(v!=="all"&&t.type!==v||j!=="all"&&t.category!==j||p.start&&t.date<p.start||p.end&&t.date>p.end)).sort((t,n)=>new Date(n.date)-new Date(t.date)),w=new Date,q=new Date(w.getFullYear(),w.getMonth(),1).toISOString().slice(0,10),S=s.filter(t=>t.date>=q),a={totalIncome:s.filter(t=>t.amount>0).reduce((t,n)=>t+n.amount,0),totalExpenses:s.filter(t=>t.amount<0).reduce((t,n)=>t+Math.abs(n.amount),0),monthlyIncome:S.filter(t=>t.amount>0).reduce((t,n)=>t+n.amount,0),monthlyExpenses:S.filter(t=>t.amount<0).reduce((t,n)=>t+Math.abs(n.amount),0),netProfit:s.reduce((t,n)=>t+n.amount,0),monthlyNet:S.reduce((t,n)=>t+n.amount,0)},N=ee(),x=a.totalIncome>0?a.netProfit/a.totalIncome*100:0,C=()=>i.type==="expense"?W:O,_=()=>{const t=C().find(n=>n.name===i.category);return t?t.subcategories:[]};return e.jsxs("section",{children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",flexWrap:"wrap",gap:"12px"},children:[e.jsx("h2",{style:{margin:0},children:"Financial Management"}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("button",{onClick:P,title:"Export to CSV",children:"ðŸ“Š CSV"}),e.jsx("button",{onClick:z,title:"Export to Excel",children:"ðŸ“ˆ Excel"}),e.jsx("button",{onClick:A,title:"Export to JSON",children:"ðŸ“„ JSON"}),e.jsx("button",{onClick:L,title:"Import from file",children:"ðŸ“¥ Import"}),e.jsx("input",{ref:T,type:"file",accept:".csv,.json",style:{display:"none"},onChange:K}),e.jsx("button",{onClick:()=>m(!k),style:{background:"var(--green)",color:"#fff",padding:"10px 16px",borderRadius:"8px",border:"none"},children:"Add Transaction"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"20px"},children:[e.jsxs("div",{className:"card",style:{padding:"20px",background:"#f0fdf4"},children:[e.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#15803d"},children:"Total Income"}),e.jsxs("div",{style:{fontSize:"28px",fontWeight:"700",color:"#15803d"},children:["KES ",a.totalIncome.toLocaleString("en-KE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:["This Month: KES ",a.monthlyIncome.toFixed(2)]})]}),e.jsxs("div",{className:"card",style:{padding:"20px",background:"#fef2f2"},children:[e.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#dc2626"},children:"Total Expenses"}),e.jsxs("div",{style:{fontSize:"28px",fontWeight:"700",color:"#dc2626"},children:["KES ",a.totalExpenses.toLocaleString("en-KE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:["This Month: KES ",a.monthlyExpenses.toFixed(2)]})]}),e.jsxs("div",{className:"card",style:{padding:"20px",background:a.netProfit>=0?"#ecfdf5":"#fef2f2"},children:[e.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"14px",color:a.netProfit>=0?"#059669":"#dc2626"},children:"Net Profit/Loss"}),e.jsxs("div",{style:{fontSize:"28px",fontWeight:"700",color:a.netProfit>=0?"#059669":"#dc2626"},children:[a.netProfit>=0?"+":"","KES ",a.netProfit.toLocaleString("en-KE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:["This Month: ",a.monthlyNet>=0?"+":"","KES ",a.monthlyNet.toFixed(2)]})]}),e.jsxs("div",{className:"card",style:{padding:"20px",background:x>=0?"#eff6ff":"#fef2f2"},children:[e.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"14px",color:x>=0?"#2563eb":"#dc2626"},children:"Profit Margin"}),e.jsxs("div",{style:{fontSize:"28px",fontWeight:"700",color:x>=0?"#2563eb":"#dc2626"},children:[x.toFixed(1),"%"]}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:x>=20?"ðŸŽ‰ Excellent":x>=10?"ðŸ‘ Good":x>=0?"âš ï¸ Low":"âŒ Loss"})]})]}),N.sources.length>0&&e.jsxs("div",{className:"card",style:{padding:"20px",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:"0 0 16px 0",fontSize:"18px"},children:"Income & Expenses by Source"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"12px"},children:N.sources.map(t=>e.jsxs("div",{style:{padding:"12px",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"14px",marginBottom:"8px",color:"#374151"},children:t.source}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:["Income: ",e.jsxs("span",{style:{color:"#15803d",fontWeight:"600"},children:["KES ",t.income.toFixed(2)]})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:["Expenses: ",e.jsxs("span",{style:{color:"#dc2626",fontWeight:"600"},children:["KES ",t.expenses.toFixed(2)]})]}),e.jsxs("div",{style:{fontSize:"12px",borderTop:"1px solid #e5e7eb",paddingTop:"4px",marginTop:"4px"},children:["Net: ",e.jsxs("span",{style:{color:t.net>=0?"#059669":"#dc2626",fontWeight:"700"},children:[t.net>=0?"+":"","KES ",t.net.toFixed(2)]})]})]},t.source))})]})]}),k&&e.jsxs("div",{className:"card",style:{marginBottom:"20px",padding:"20px"},children:[e.jsx("h3",{children:g?"Edit Transaction":"Add New Transaction"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Type"}),e.jsxs("select",{value:i.type,onChange:t=>{const n=t.target.value;r({...i,type:n,category:n==="expense"?"Feed":"Milk Sales",subcategory:n==="expense"?"Hay":"Wholesale"})},children:[e.jsx("option",{value:"expense",children:"Expense"}),e.jsx("option",{value:"income",children:"Income"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",value:i.amount,onChange:t=>r({...i,amount:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Date"}),e.jsx("input",{type:"date",value:i.date,onChange:t=>r({...i,date:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Category"}),e.jsx("select",{value:i.category,onChange:t=>{const n=t.target.value,o=C().find(d=>d.name===n)?.subcategories||[];r({...i,category:n,subcategory:o[0]||""})},children:C().map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Subcategory"}),e.jsx("select",{value:i.subcategory,onChange:t=>r({...i,subcategory:t.target.value}),children:_().map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Payment Method"}),e.jsx("select",{value:i.paymentMethod,onChange:t=>r({...i,paymentMethod:t.target.value}),children:ne.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Description"}),e.jsx("input",{placeholder:"Enter transaction description",value:i.description,onChange:t=>r({...i,description:t.target.value})})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Vendor/Customer"}),e.jsx("input",{placeholder:"Enter vendor or customer name",value:i.vendor,onChange:t=>r({...i,vendor:t.target.value})})]})]}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:g?J:V,style:{background:"var(--green)",color:"#fff",padding:"10px 16px",border:"none",borderRadius:"6px"},children:g?"Save Changes":"Add Transaction"}),e.jsx("button",{onClick:g?G:()=>m(!1),style:{background:"#6b7280",color:"#fff",padding:"10px 16px",border:"none",borderRadius:"6px"},children:"Cancel"})]})]}),e.jsx("div",{className:"card",style:{marginBottom:"20px",padding:"16px"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Type"}),e.jsxs("select",{value:v,onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"income",children:"Income"}),e.jsx("option",{value:"expense",children:"Expenses"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Category"}),e.jsxs("select",{value:j,onChange:t=>M(t.target.value),children:[e.jsx("option",{value:"all",children:"All Categories"}),[...W,...O].map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Start Date"}),e.jsx("input",{type:"date",value:p.start,onChange:t=>b({...p,start:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"End Date"}),e.jsx("input",{type:"date",value:p.end,onChange:t=>b({...p,end:t.target.value})})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{F("all"),M("all"),b({start:"",end:""})},style:{background:"#6b7280",color:"#fff",padding:"8px 12px",border:"none",borderRadius:"4px"},children:"Clear Filters"})})]})}),e.jsx("div",{style:{display:"grid",gap:"8px"},children:$.map(t=>e.jsx("div",{className:"card",style:{padding:"16px",borderLeft:`4px solid ${t.amount>=0?"var(--green)":"#dc2626"}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"4px"},children:[e.jsx("h4",{style:{margin:0},children:t.description}),e.jsx("span",{className:`badge ${t.amount>=0?"green":""}`,children:t.category}),e.jsx("span",{className:"badge",children:t.subcategory})]}),e.jsxs("div",{style:{display:"flex",gap:"20px",fontSize:"14px",color:"var(--muted)",marginBottom:"4px"},children:[e.jsxs("span",{children:["ðŸ“… ",t.date]}),e.jsxs("span",{children:["ðŸ’³ ",t.paymentMethod]}),t.vendor&&e.jsxs("span",{children:["ðŸª ",t.vendor]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:t.amount>=0?"var(--green)":"#dc2626"},children:[t.amount>=0?"+":"-","KES ",Math.abs(t.amount).toLocaleString("en-KE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("div",{style:{fontSize:"12px",color:"var(--muted)"},children:t.id})]}),e.jsxs("div",{className:"controls",children:[e.jsx("button",{onClick:()=>u(t.id),children:"View"}),e.jsx("button",{onClick:()=>D(t),children:"Edit"}),e.jsx("button",{onClick:()=>R(t.id),children:"Delete"})]})]})]})},t.id))}),I&&(()=>{const t=s.find(n=>n.id===I);return t?e.jsx("div",{className:"drawer-overlay",onClick:()=>u(null),children:e.jsxs("div",{className:"drawer",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{children:t.description}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{u(null),D(t)},children:"Edit"}),e.jsx("button",{onClick:()=>u(null),style:{marginLeft:"8px"},children:"Close"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 300px",gap:"20px"},children:[e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("h4",{children:"Transaction Notes"}),e.jsx("div",{style:{marginBottom:"12px"},children:e.jsx("input",{placeholder:"Add a note...",onKeyPress:n=>{n.key==="Enter"&&n.target.value.trim()&&(H(t.id,n.target.value),n.target.value="")},style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #d1d5db"}})}),e.jsxs("div",{style:{maxHeight:"400px",overflowY:"auto"},children:[(t.notes||[]).slice().reverse().map(n=>e.jsxs("div",{style:{padding:"12px",background:"#f9fafb",borderRadius:"8px",marginBottom:"12px"},children:[e.jsxs("div",{style:{fontSize:"12px",color:"var(--muted)",marginBottom:"4px"},children:[n.author," â€¢ ",new Date(n.date).toLocaleString()]}),e.jsx("div",{children:n.text})]},n.id)),(!t.notes||t.notes.length===0)&&e.jsx("div",{style:{color:"var(--muted)",fontStyle:"italic",padding:"20px",textAlign:"center"},children:"No notes yet"})]})]})}),e.jsxs("div",{className:"card",style:{padding:"20px",height:"fit-content"},children:[e.jsx("h4",{children:"Transaction Details"}),e.jsxs("div",{style:{display:"grid",gap:"12px",fontSize:"14px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Amount:"}),e.jsxs("span",{style:{color:t.amount>=0?"var(--green)":"#dc2626",fontWeight:"700",marginLeft:"8px"},children:[t.amount>=0?"+":"-","KES ",Math.abs(t.amount).toLocaleString("en-KE",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",e.jsx("span",{className:`badge ${t.amount>=0?"green":""}`,children:t.type})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Category:"})," ",t.category]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Subcategory:"})," ",t.subcategory]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",t.date]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Payment Method:"})," ",t.paymentMethod]}),t.vendor&&e.jsxs("div",{children:[e.jsx("strong",{children:"Vendor/Customer:"})," ",t.vendor]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Transaction ID:"})," ",t.id]}),t.createdDate&&e.jsxs("div",{children:[e.jsx("strong",{children:"Created:"})," ",new Date(t.createdDate).toLocaleString()]})]})]})]})]})}):null})()]})}export{xe as default};
