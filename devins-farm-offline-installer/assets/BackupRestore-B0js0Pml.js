import{r as i,j as e}from"./index-CeDgDi5r.js";import{l as f,o as b,p as g,q as y,u as v,r as h,E as N,A as B}from"./lib-export-Dp5-osfT.js";import"./vendor-react-CqO7gtIP.js";import"./lib-core-XQuPJE47.js";import"./lib-notifications-DRlqN2Ug.js";import"./lib-integration-BX7JWOcy.js";import"./vendor-firebase-DPzZ0AXH.js";function D(){const[r,m]=i.useState(null),[o,x]=i.useState(null),[l,n]=i.useState(!1),[u,a]=i.useState(null);i.useEffect(()=>{d(),f(B.VIEW,N.OTHER,null,"Viewed backup/restore")},[]);const d=()=>{const s=b(),c=g();m(s),x(c)},p=async()=>{try{const s=y();s.success?(v(),a({type:"success",text:`âœ… Backup created successfully! File: ${s.filename} (${(s.size/1024).toFixed(2)} KB)`}),d()):a({type:"error",text:`âŒ Backup failed: ${s.error}`})}catch(s){a({type:"error",text:`âŒ Error creating backup: ${s.message}`})}},j=async s=>{const c=s.target.files[0];if(c){n(!0),a({type:"info",text:"â³ Restoring backup..."});try{const t=await h(c,{merge:!1,createBackupFirst:!0,restoreUsers:!1,restoreAudit:!1});t.success?(a({type:"success",text:`âœ… Backup restored successfully! Restored from ${new Date(t.backupDate).toLocaleString()}`}),d(),setTimeout(()=>{confirm("Backup restored! Reload page to see changes?")&&window.location.reload()},2e3)):t.cancelled?a({type:"info",text:"â„¹ï¸ Restore cancelled"}):a({type:"error",text:`âŒ Restore failed: ${t.error}`})}catch(t){a({type:"error",text:`âŒ Error restoring backup: ${t.message}`})}finally{n(!1),s.target.value=""}}},k=async s=>{const c=s.target.files[0];if(c){n(!0),a({type:"info",text:"â³ Merging backup data..."});try{const t=await h(c,{merge:!0,createBackupFirst:!0,restoreUsers:!1,restoreAudit:!1});t.success?(a({type:"success",text:`âœ… Backup merged successfully! Added new records from ${new Date(t.backupDate).toLocaleString()}`}),d(),setTimeout(()=>{confirm("Backup merged! Reload page to see changes?")&&window.location.reload()},2e3)):t.cancelled?a({type:"info",text:"â„¹ï¸ Merge cancelled"}):a({type:"error",text:`âŒ Merge failed: ${t.error}`})}catch(t){a({type:"error",text:`âŒ Error merging backup: ${t.message}`})}finally{n(!1),s.target.value=""}}};return e.jsxs("div",{className:"backup-restore-container",children:[e.jsx("h1",{children:"ğŸ’¾ Backup & Restore"}),u&&e.jsx("div",{className:`message message-${u.type}`,children:u.text}),o?.needsBackup&&e.jsxs("div",{className:"backup-reminder warning",children:[e.jsx("h3",{children:"âš ï¸ Backup Reminder"}),e.jsx("p",{children:o.message}),e.jsx("button",{onClick:p,className:"btn-primary",children:"Create Backup Now"})]}),r&&e.jsxs("div",{className:"backup-stats",children:[e.jsx("h2",{children:"ğŸ“Š Current Data Statistics"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:r.totalRecords}),e.jsx("div",{className:"stat-label",children:"Total Records"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:r.animals}),e.jsx("div",{className:"stat-label",children:"Animals"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:r.transactions}),e.jsx("div",{className:"stat-label",children:"Transactions"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:r.tasks}),e.jsx("div",{className:"stat-label",children:"Tasks"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:r.inventory}),e.jsx("div",{className:"stat-label",children:"Inventory Items"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:r.treatments}),e.jsx("div",{className:"stat-label",children:"Treatments"})]})]}),r.lastBackup&&e.jsxs("p",{className:"last-backup",children:["Last backup: ",new Date(r.lastBackup).toLocaleString(),"(",o?.daysSince," days ago)"]})]}),e.jsxs("div",{className:"backup-section",children:[e.jsx("h2",{children:"ğŸ“¦ Create Backup"}),e.jsx("p",{children:"Download a complete backup of all your farm data to a JSON file."}),e.jsxs("div",{className:"backup-info",children:[e.jsx("h4",{children:"What's included in the backup:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"âœ… All animal records and history"}),e.jsx("li",{children:"âœ… Financial transactions"}),e.jsx("li",{children:"âœ… Inventory items"}),e.jsx("li",{children:"âœ… Tasks and schedules"}),e.jsx("li",{children:"âœ… Crops and yields"}),e.jsx("li",{children:"âœ… Treatments and breeding records"}),e.jsx("li",{children:"âœ… Feed records and measurements"}),e.jsx("li",{children:"âœ… Groups, pastures, and equipment"}),e.jsx("li",{children:"âœ… All settings and preferences"})]})]}),e.jsx("button",{onClick:p,className:"btn-backup",children:"ğŸ“¥ Download Backup File"})]}),e.jsxs("div",{className:"restore-section",children:[e.jsx("h2",{children:"â™»ï¸ Restore from Backup"}),e.jsx("p",{children:"Restore your data from a previously created backup file."}),e.jsxs("div",{className:"restore-options",children:[e.jsxs("div",{className:"restore-option",children:[e.jsx("h3",{children:"ğŸ”„ Replace All Data"}),e.jsxs("p",{children:["âš ï¸ This will ",e.jsx("strong",{children:"delete all current data"})," and replace it with the backup."]}),e.jsx("p",{children:"A safety backup of your current data will be created first."}),e.jsxs("label",{className:"file-input-label",children:[e.jsx("input",{type:"file",accept:".json",onChange:j,disabled:l,style:{display:"none"}}),e.jsx("button",{className:"btn-restore",disabled:l,onClick:s=>s.currentTarget.previousElementSibling.click(),children:l?"â³ Restoring...":"ğŸ“¤ Choose Backup File to Restore"})]})]}),e.jsxs("div",{className:"restore-option",children:[e.jsx("h3",{children:"â• Merge with Current Data"}),e.jsx("p",{children:"Add new records from backup without deleting current data."}),e.jsx("p",{children:"Existing records with the same ID will be kept (no overwrite)."}),e.jsxs("label",{className:"file-input-label",children:[e.jsx("input",{type:"file",accept:".json",onChange:k,disabled:l,style:{display:"none"}}),e.jsx("button",{className:"btn-merge",disabled:l,onClick:s=>s.currentTarget.previousElementSibling.click(),children:l?"â³ Merging...":"ğŸ”€ Choose Backup File to Merge"})]})]})]})]}),e.jsxs("div",{className:"backup-best-practices",children:[e.jsx("h2",{children:"ğŸ’¡ Backup Best Practices"}),e.jsxs("ul",{children:[e.jsx("li",{children:"ğŸ—“ï¸ Create regular backups (weekly recommended)"}),e.jsx("li",{children:"ğŸ’¾ Store backup files in multiple locations (external drive, cloud storage)"}),e.jsx("li",{children:"ğŸ“… Name backups with dates for easy identification"}),e.jsx("li",{children:"ğŸ§ª Test restore process occasionally to ensure backups work"}),e.jsx("li",{children:"ğŸ” Keep backups secure (they contain sensitive farm data)"}),e.jsx("li",{children:"ğŸ“Š Create backups before major data imports or changes"})]})]})]})}export{D as default};
