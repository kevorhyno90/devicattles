import{l as f}from"./lib-core-XQuPJE47.js";const d="devinsfarm:notifications",T="devinsfarm:notification:settings",y="devinsfarm:reminders",g={enabled:!0,treatmentReminders:!0,breedingReminders:!0,taskReminders:!0,inventoryAlerts:!0,healthAlerts:!0,reminderLeadTime:24,lowInventoryThreshold:10,criticalInventoryThreshold:5,soundEnabled:!0},s={TREATMENT:"treatment",BREEDING:"breeding",TASK:"task",INVENTORY:"inventory",HEALTH:"health",GENERAL:"general"},a={LOW:"low",MEDIUM:"medium",HIGH:"high",URGENT:"urgent"};async function O(){return"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.warn("Browser does not support notifications"),!1)}function w(){return"Notification"in window&&Notification.permission==="granted"}function I(){try{const t=localStorage.getItem(T);return t?{...g,...JSON.parse(t)}:g}catch(t){return console.error("Error loading notification settings:",t),g}}function k(t){try{const r={...I(),...t};return localStorage.setItem(T,JSON.stringify(r)),r}catch(n){return console.error("Error saving notification settings:",n),t}}function c(t,n={}){const r=I();if(!r.enabled||!w())return D(t,n),null;const e=new Notification(t,{icon:"/icon-192x192.png",badge:"/icon-192x192.png",vibrate:[200,100,200],requireInteraction:n.priority===a.URGENT,...n});return D(t,n),r.soundEnabled&&p(),e}function D(t,n={}){try{const r=u(),e={id:Date.now()+Math.random(),title:t,body:n.body||"",type:n.type||s.GENERAL,priority:n.priority||a.MEDIUM,timestamp:new Date().toISOString(),read:!1,data:n.data||{}};return r.unshift(e),r.length>100&&r.splice(100),localStorage.setItem(d,JSON.stringify(r)),window.dispatchEvent(new CustomEvent("newNotification",{detail:e})),e}catch(r){return console.error("Error adding notification:",r),null}}function u(){try{const t=localStorage.getItem(d);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading notifications:",t),[]}}function v(){return u().filter(n=>!n.read).length}function G(t){try{const n=u(),r=n.find(e=>e.id===t);return r&&(r.read=!0,localStorage.setItem(d,JSON.stringify(n))),r}catch(n){return console.error("Error marking notification as read:",n),null}}function $(){try{const t=u();return t.forEach(n=>n.read=!0),localStorage.setItem(d,JSON.stringify(t)),!0}catch(t){return console.error("Error marking all as read:",t),!1}}function M(){try{return localStorage.setItem(d,JSON.stringify([])),!0}catch(t){return console.error("Error clearing notifications:",t),!1}}function U(t){try{const r=u().filter(e=>e.id!==t);return localStorage.setItem(d,JSON.stringify(r)),!0}catch(n){return console.error("Error deleting notification:",n),!1}}function p(){try{const t=new(window.AudioContext||window.webkitAudioContext),n=t.createOscillator(),r=t.createGain();n.connect(r),r.connect(t.destination),n.frequency.value=800,n.type="sine",r.gain.setValueAtTime(.3,t.currentTime),r.gain.exponentialRampToValueAtTime(.01,t.currentTime+.5),n.start(t.currentTime),n.stop(t.currentTime+.5)}catch(t){console.error("Error playing notification sound:",t)}}function l(){try{const t=localStorage.getItem(y);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading reminders:",t),[]}}function x(t){try{const n=l(),r=n.find(e=>e.id===t);return r&&(r.dismissed=!0,localStorage.setItem(y,JSON.stringify(n))),r}catch(n){return console.error("Error dismissing reminder:",n),null}}function C(t){try{const r=l().filter(e=>e.id!==t);return localStorage.setItem(y,JSON.stringify(r)),!0}catch(n){return console.error("Error deleting reminder:",n),!1}}function E(){const t=I();if(!t.enabled)return[];const n=l(),r=new Date,e=t.reminderLeadTime*60*60*1e3,i=n.filter(o=>o.notified||o.dismissed?!1:new Date(o.dueDate)-r<=e);return i.forEach(o=>{const m=new Date(o.dueDate)<r;c(m?`âš ï¸ OVERDUE: ${o.title}`:`ðŸ”” Reminder: ${o.title}`,{body:o.body,type:o.type,priority:m?a.URGENT:o.priority,data:{reminderId:o.id,entityId:o.entityId,entityType:o.entityType}}),o.notified=!0}),i.length>0&&localStorage.setItem(y,JSON.stringify(n)),i}function H(t=7){const n=l(),r=new Date,e=new Date(r.getTime()+t*24*60*60*1e3);return n.filter(i=>!i.dismissed&&new Date(i.dueDate)<=e).sort((i,o)=>new Date(i.dueDate)-new Date(o.dueDate))}function J(){const t=l(),n=new Date;return t.filter(r=>!r.dismissed&&new Date(r.dueDate)<n).sort((r,e)=>new Date(r.dueDate)-new Date(e.dueDate))}function L(){const t=setInterval(()=>{E()},3e5);return E(),t}function B(t){t&&clearInterval(t)}function h(){try{const t=f("treatments",[]);if(!Array.isArray(t)){console.warn("Treatments data is not an array:",typeof t);return}const n=new Date,r=new Date(n.getTime()+1440*60*1e3);t.forEach(e=>{if(e.nextDue){const i=new Date(e.nextDue);i.toDateString()===n.toDateString()&&c("Treatment Due Today",{body:`Treatment for ${e.animalName||e.animalId} is due today`,type:s.TREATMENT,priority:a.HIGH,data:{treatmentId:e.id,animalId:e.animalId}}),i.toDateString()===r.toDateString()&&c("Treatment Due Tomorrow",{body:`Treatment for ${e.animalName||e.animalId} is due tomorrow`,type:s.TREATMENT,priority:a.MEDIUM,data:{treatmentId:e.id,animalId:e.animalId}})}})}catch(t){console.error("Error checking treatment reminders:",t)}}function S(){try{const t=f("breeding",[]);if(!Array.isArray(t)){console.warn("Breeding data is not an array:",typeof t);return}const n=new Date,r=new Date(n.getTime()+1440*60*1e3);t.forEach(e=>{if(e.dueDate&&(e.status==="Pregnant"||e.status==="Confirmed")){const i=new Date(e.dueDate);if(i<n)c("âš ï¸ Breeding Overdue",{body:`${e.animalName||e.animalId} is overdue for birth (Due: ${i.toLocaleDateString()})`,type:s.BREEDING,priority:a.URGENT,data:{breedingId:e.id,animalId:e.animalId}});else if(i>=n&&i<=next7Days){const o=Math.ceil((i-n)/864e5);c("Birth Expected Soon",{body:`${e.animalName||e.animalId} expected to give birth in ${o} day(s)`,type:s.BREEDING,priority:a.HIGH,data:{breedingId:e.id,animalId:e.animalId}})}}})}catch(t){console.error("Error checking breeding reminders:",t)}}function R(){try{const t=f("tasks",[]);if(!Array.isArray(t)){console.warn("Tasks data is not an array:",typeof t);return}const n=new Date,r=new Date(n.getTime()+1440*60*1e3);t.forEach(e=>{if(e.dueDate&&e.status!=="Completed"){const i=new Date(e.dueDate);i<n?c("âš ï¸ Task Overdue",{body:`"${e.title}" is overdue`,type:s.TASK,priority:a.URGENT,data:{taskId:e.id}}):i.toDateString()===n.toDateString()?c("Task Due Today",{body:`"${e.title}" is due today`,type:s.TASK,priority:a.HIGH,data:{taskId:e.id}}):i.toDateString()===r.toDateString()&&c("Task Due Tomorrow",{body:`"${e.title}" is due tomorrow`,type:s.TASK,priority:a.MEDIUM,data:{taskId:e.id}})}})}catch(t){console.error("Error checking task reminders:",t)}}function A(t=10,n=5){try{const r=f("inventory",[]);if(!Array.isArray(r)){console.warn("Inventory data is not an array:",typeof r);return}r.forEach(e=>{const i=parseFloat(e.quantity)||0;i>0&&i<=n?c("ðŸš¨ Critical Stock Alert",{body:`"${e.name}" is critically low (${i} ${e.unit||"units"} remaining)`,type:s.INVENTORY,priority:a.URGENT,data:{itemId:e.id}}):i>n&&i<=t?c("Low Stock Warning",{body:`"${e.name}" is running low (${i} ${e.unit||"units"} remaining)`,type:s.INVENTORY,priority:a.MEDIUM,data:{itemId:e.id}}):i<=0&&c("âš ï¸ Out of Stock",{body:`"${e.name}" is out of stock`,type:s.INVENTORY,priority:a.HIGH,data:{itemId:e.id}})})}catch(r){console.error("Error checking inventory alerts:",r)}}function Y(){h(),S(),R(),A()}export{s as N,a as P,B as a,I as b,Y as c,u as d,l as e,H as f,v as g,J as h,w as i,$ as j,U as k,M as l,G as m,x as n,C as o,k as p,O as r,L as s};
