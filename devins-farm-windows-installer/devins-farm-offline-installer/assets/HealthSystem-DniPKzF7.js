import{r as p,j as e}from"./index-CeDgDi5r.js";function Q(r){const d=(r||"").split(",")[1]||"";return Math.round(d.length*3/4)}function fe(r=""){return r+Math.random().toString(36).slice(2,9)}function ne(r,{maxDim:d=1024,quality:g=.8}={}){return new Promise((x,f)=>{if(!r)return f(new Error("No file"));const v=new FileReader;v.onerror=()=>f(new Error("File read error")),v.onload=()=>{const N=new Image;N.onload=()=>{let{width:m,height:I}=N;if(Math.max(m,I)>d){const S=d/Math.max(m,I);m=Math.round(m*S),I=Math.round(I*S)}const u=document.createElement("canvas");u.width=m,u.height=I,u.getContext("2d").drawImage(N,0,0,m,I);const y="image/jpeg";try{const S=u.toDataURL(y,g),L=Q(S);x({dataUrl:S,mime:y,size:L})}catch{const L=v.result,h=Q(L);x({dataUrl:L,mime:r.type||"image/jpeg",size:h})}},N.onerror=()=>f(new Error("Invalid image")),N.src=v.result},v.readAsDataURL(r)})}const G="cattalytics:health:patients",X="cattalytics:health:appointments",Z="cattalytics:health:prescriptions",ee="cattalytics:health:inventory",te="cattalytics:health:billing";function R(r=""){return r+Math.random().toString(36).slice(2,9)}function ae({animals:r=[]}){const[d,g]=p.useState("records"),[x,f]=p.useState([]),[v,N]=p.useState([]),[m,I]=p.useState([]),[u,o]=p.useState([]),[y,S]=p.useState([]),[L,h]=p.useState(!1),[$,P]=p.useState(null),[J,_]=p.useState(""),[z,U]=p.useState("move");p.useEffect(()=>{try{f(JSON.parse(localStorage.getItem(G)||"[]"))}catch{f([])}},[]),p.useEffect(()=>{try{N(JSON.parse(localStorage.getItem(X)||"[]"))}catch{N([])}},[]),p.useEffect(()=>{try{I(JSON.parse(localStorage.getItem(Z)||"[]"))}catch{I([])}},[]),p.useEffect(()=>{try{o(JSON.parse(localStorage.getItem(ee)||"[]"))}catch{o([])}},[]),p.useEffect(()=>{try{S(JSON.parse(localStorage.getItem(te)||"[]"))}catch{S([])}},[]),p.useEffect(()=>localStorage.setItem(G,JSON.stringify(x)),[x]),p.useEffect(()=>localStorage.setItem(X,JSON.stringify(v)),[v]),p.useEffect(()=>localStorage.setItem(Z,JSON.stringify(m)),[m]),p.useEffect(()=>localStorage.setItem(ee,JSON.stringify(u)),[u]),p.useEffect(()=>localStorage.setItem(te,JSON.stringify(y)),[y]);function t(n){n.id=n.id||R("p-"),n.createdAt=new Date().toISOString(),f(s=>[...s,n])}function i(n,s){f(a=>a.map(c=>c.id===n?{...c,...s}:c))}function l(n){window.confirm("Delete patient?")&&f(s=>s.filter(a=>a.id!==n))}function A(n){n.id=n.id||R("a-"),n.createdAt=new Date().toISOString(),N(s=>[...s,n])}function D(n){n.id=n.id||R("r-"),n.createdAt=new Date().toISOString(),I(s=>[...s,n])}function H(n){n.id=n.id||R("i-"),n.qty=Number(n.qty||0),o(s=>[...s,n])}function T(n,s,a){const c={id:R("b-"),patientId:n,desc:s,amount:Number(a||0),paid:!1,createdAt:new Date().toISOString()};S(b=>[...b,c])}function q(n,s=!0){S(a=>a.map(c=>c.id===n?{...c,paid:s}:c))}async function W(n,s){if(!(!s||!n))try{const{dataUrl:a,mime:c,size:b}=await ne(s,{maxDim:1200,quality:.8}),k={id:R("att-"),filename:s.name,dataUrl:a,mime:c,size:b,createdAt:new Date().toISOString()};f(B=>B.map(M=>M.id===n?{...M,attachments:[...M.attachments||[],k]}:M))}catch(a){console.error(a),alert("Attach failed")}}function C(n,s){const a={id:R("n-"),...s,createdAt:new Date().toISOString()};f(c=>c.map(b=>b.id===n?{...b,notes:[...b.notes||[],a]}:b))}function w(n,s,a){a.id=a.id||R(s+"-"),a.createdAt=new Date().toISOString(),f(c=>c.map(b=>b.id===n?{...b,[s]:[...b[s]||[],a]}:b))}function E(n,s={}){f(a=>a.map(c=>c.id===n?{...c,admitted:!0,admittedAt:new Date().toISOString(),admissionMeta:{...c.admissionMeta||{},...s}}:c))}function V(n,s=""){f(a=>a.map(c=>c.id===n?{...c,admitted:!1,dischargedAt:new Date().toISOString(),dischargeNote:s}:c))}function F(n,s,a="move"){if(!n||!s){alert("Please select a source and target");return}if(n===s){alert("Source and target are the same");return}const c=x.find(k=>k.id===n),b=x.find(k=>k.id===s);if(!c||!b){alert("Source or target patient not found");return}if(a==="move")i(n,{admitted:!1,dischargeNote:"Transferred to "+s,dischargedAt:new Date().toISOString()}),i(s,{admitted:!0,admittedAt:new Date().toISOString(),admissionMeta:{...b.admissionMeta||{},transferredFrom:n}}),alert(`Admission moved from ${c.name||n} to ${b.name||s}`);else if(a==="merge"){const k={...b},B=(M,O)=>[...M||[],...O||[]];k.notes=B(b.notes,c.notes),k.vitals=B(b.vitals,c.vitals),k.vaccinations=B(b.vaccinations,c.vaccinations),k.medications=B(b.medications,c.medications),k.attachments=B(b.attachments,c.attachments),k.surgeries=B(b.surgeries,c.surgeries),k.admitted=!!(b.admitted||c.admitted),k.admittedAt=b.admittedAt||c.admittedAt,S(M=>M.map(O=>O.patientId===n?{...O,patientId:s}:O)),f(M=>M.reduce((O,j)=>{if(j.id===s)O.push(k);else{if(j.id===n)return O;O.push(j)}return O},[])),alert(`Merged ${c.name||n} into ${b.name||s}. Source record removed.`)}h(!1),P(null),_(""),U("move")}function K(n,s="export.json"){try{const a=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),c=URL.createObjectURL(a),b=document.createElement("a");b.href=c,b.download=s,document.body.appendChild(b),b.click(),b.remove(),URL.revokeObjectURL(c)}catch(a){console.error("download failed",a)}}function Y(n){try{const s=x.find(j=>j.id===n);if(!s){alert("Patient not found");return}const a=j=>'"'+String(j??"").replace(/"/g,'""')+'"',c=[],k=[["section","date","patientId","patientName","c1","c2","c3","notes"](s.vitals||[]).forEach(j=>c.push(["vital",j.createdAt||j.date||"",s.id,s.name||"",j.weight??"",j.temp??"",j.hr??"",j.notes||""]))(s.vaccinations||[]).forEach(j=>c.push(["vaccination",j.createdAt||j.date||"",s.id,s.name||"",j.vaccine||"",j.lot||"","",j.notes||""]))(s.medications||[]).forEach(j=>c.push(["medication",j.createdAt||j.date||"",s.id,s.name||"",j.drug||"",j.dose||"","",j.notes||""]))(s.notes||[]).forEach(j=>c.push(["note",j.createdAt||"",s.id,s.name||"",j.subjective||"",j.objective||"",j.assessment||"",j.plan||""]))(s.attachments||[]).forEach(j=>c.push(["attachment",j.createdAt||"",s.id,s.name||"",j.filename||"",j.mime||"",j.size||"",""])),...c].map(j=>j.map(a).join(",")).join(`
`),B=new Blob([k],{type:"text/csv"}),M=URL.createObjectURL(B),O=document.createElement("a");O.href=M,O.download=`patient-${s.id}.csv`,document.body.appendChild(O),O.click(),O.remove(),URL.revokeObjectURL(M)}catch(s){console.error("patient csv failed",s),alert("Export failed")}}return x.length,y.filter(n=>!n.paid).reduce((n,s)=>n+Number(s.amount||0),0),e.jsxs("div",{className:"health-root",children:[e.jsxs("div",{className:"health-header",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"health-title",children:"Devins Farm — Health"}),e.jsx("div",{className:"muted",children:"Patient information management system (PIMS)"})]}),e.jsxs("div",{className:"health-toolbar",children:[e.jsx("button",{className:`tab-btn ${d==="records"?"active":""}`,onClick:()=>g("records"),children:"Records"}),e.jsx("button",{className:`tab-btn ${d==="appointments"?"active":""}`,onClick:()=>g("appointments"),children:"Appointments"}),e.jsx("button",{className:`tab-btn ${d==="prescriptions"?"active":""}`,onClick:()=>g("prescriptions"),children:"Prescriptions"}),e.jsx("button",{className:`tab-btn ${d==="inventory"?"active":""}`,onClick:()=>g("inventory"),children:"Inventory"}),e.jsx("button",{className:`tab-btn ${d==="billing"?"active":""}`,onClick:()=>g("billing"),children:"Billing"}),e.jsx("button",{className:`tab-btn ${d==="reports"?"active":""}`,onClick:()=>g("reports"),children:"Reports"}),e.jsx("button",{className:`tab-btn ${d==="admissions"?"active":""}`,onClick:()=>g("admissions"),children:"Admissions"})]})]}),e.jsxs("div",{className:"panel",children:[d==="records"&&e.jsxs("div",{className:"columns",children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:"Patients"}),e.jsx("button",{className:"tab-btn",onClick:()=>{const n={id:R("p-"),name:"",animalId:"",tag:"",owner:{},ids:{},notes:[],vaccinations:[],medications:[],surgeries:[],communications:[],attachments:[]};t(n)},children:"New"})]}),e.jsx("div",{style:{marginTop:8,maxHeight:520,overflow:"auto",display:"grid",gap:8},children:x.map(n=>e.jsxs("div",{onClick:()=>{},className:"patient-list-item",children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:n.name||"(unnamed)"}),e.jsx("div",{className:"muted",style:{fontSize:12},children:n.tag||""})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:n.createdAt?new Date(n.createdAt).toLocaleDateString():""}),e.jsxs("div",{className:"badge",children:[(n.notes||[]).length," notes"]})]})]},n.id))})]}),e.jsx("div",{children:e.jsx(ie,{patients:x,addPatient:t,updatePatient:i,removePatient:l,attachFileToPatient:W,addSoapNote:C,pushEntry:w,admitPatient:E,dischargePatient:V,animals:r})})]}),d==="appointments"&&e.jsx(me,{patients:x,appointments:v,createAppointment:A}),d==="prescriptions"&&e.jsx(ue,{patients:x,prescriptions:m,addPrescription:D,inventory:u}),d==="inventory"&&e.jsx(he,{inventory:u,addInventory:H,adjustInventory:(n,s)=>o(a=>a.map(c=>c.id===n?{...c,qty:Math.max(0,Number(c.qty||0)+s)}:c))}),d==="billing"&&e.jsx(pe,{patients:x,billing:y,charge:T,setInvoicePaid:q,generateInvoice:n=>alert("Generate invoice for "+n)}),d==="reports"&&e.jsx(ge,{patients:x,appointments:v,prescriptions:m,inventory:u,billing:y,downloadJson:K,downloadPatientCsv:n=>Y(n)}),d==="admissions"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h4",{children:"Admissions"}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{children:"Currently admitted patients"}),e.jsxs("div",{className:"muted",children:[x.filter(n=>n.admitted).length," admitted"]})]}),e.jsx("div",{style:{marginTop:8},children:x.filter(n=>n.admitted).length===0?e.jsx("div",{className:"muted",children:"No admitted patients"}):x.filter(n=>n.admitted).map(n=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:8,alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:n.name||"(unnamed)"}),e.jsxs("div",{className:"muted",children:["Admitted: ",n.admittedAt?new Date(n.admittedAt).toLocaleString():""," — ",n.admissionMeta?.reason||""]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"tab-btn",onClick:()=>{const s=prompt("Discharge note (optional)");V(n.id,s),i(n.id,{admitted:!1,dischargeNote:s})},children:"Discharge"}),e.jsx("button",{className:"tab-btn",onClick:()=>{h(!0),P(n.id),_(""),U("move")},children:"Transfer"})]})]},n.id))})]})]}),L&&e.jsxs("div",{style:{marginTop:12,padding:12,border:"1px solid #eee",borderRadius:8,background:"#fff"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:"Transfer / Merge"}),e.jsx("button",{className:"tab-btn",onClick:()=>{h(!1),P(null),_("")},children:"Close"})]}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:["To patient",e.jsxs("select",{value:J,onChange:n=>_(n.target.value),children:[e.jsx("option",{value:"",children:"Select target patient"}),x.filter(n=>n.id!==$).map(n=>e.jsx("option",{value:n.id,children:n.name||n.tag||n.id},n.id))]})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:["Mode",e.jsxs("select",{value:z,onChange:n=>U(n.target.value),children:[e.jsx("option",{value:"move",children:"Move admission (source remains as record)"}),e.jsx("option",{value:"merge",children:"Merge records (combine and remove source)"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"tab-btn",onClick:()=>{if(!J){alert("Pick a target patient");return}confirm(`Confirm ${z} from ${$} to ${J}?`)&&F($,J,z)},children:"Confirm"}),e.jsx("button",{className:"tab-btn",onClick:()=>{h(!1),P(null),_("")},children:"Cancel"})]})]})]})]})]})]})}function ie({patients:r=[],addPatient:d,updatePatient:g,removePatient:x,attachFileToPatient:f,addSoapNote:v,pushEntry:N,admitPatient:m,dischargePatient:I,animals:u=[]}){const[o,y]=p.useState(null),[S,L]=p.useState(!1),[h,$]=p.useState({}),[P,J]=p.useState("");p.useEffect(()=>{if(o){const t=r.find(i=>i.id===o)||{};$({...t})}else $({})},[o,r]);function _(){o&&(g(o,h),L(!1))}const z=(P||"").trim().toLowerCase(),U=z?r.filter(t=>(t.name||"").toLowerCase().includes(z)||(t.tag||"").toLowerCase().includes(z)||(t.owner?.name||"").toLowerCase().includes(z)):r;return e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsxs("div",{style:{width:320},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:"Patients"}),e.jsx("button",{onClick:()=>{const t={id:R("p-"),name:"",animalId:"",tag:"",owner:{},ids:{},notes:[],vaccinations:[],medications:[],surgeries:[],communications:[],attachments:[]};d(t),y(t.id),L(!0)},children:"New"})]}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8},children:[e.jsx("input",{"aria-label":"Search patients",placeholder:"Search name, tag, owner",value:P,onChange:t=>J(t.target.value),style:{flex:1,padding:8,border:"1px solid #ddd",borderRadius:8}}),e.jsx("button",{onClick:()=>J(""),className:"tab-btn",children:"Clear"})]}),e.jsx("div",{style:{marginTop:8,maxHeight:520,overflow:"auto"},children:U.length===0?e.jsxs("div",{className:"muted",style:{padding:10},children:['No patients match "',P,'"']}):U.map(t=>e.jsxs("div",{className:`patient-list-item ${t.id===o?"selected":""}`,children:[e.jsxs("div",{style:{flex:1,cursor:"pointer"},onClick:()=>{y(t.id),L(!1)},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{fontWeight:600},children:t.name||"(unnamed)"}),t.admitted?e.jsx("span",{className:"flag green",children:"Admitted"}):null]}),e.jsx("div",{className:"muted",style:{fontSize:12},children:t.tag||""})]}),e.jsxs("div",{style:{textAlign:"right",display:"flex",flexDirection:"column",gap:6,alignItems:"flex-end"},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:t.createdAt?new Date(t.createdAt).toLocaleDateString():""}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsxs("div",{className:"badge",children:[(t.notes||[]).length," notes"]}),t.admitted?e.jsx("button",{className:"tab-btn",onClick:i=>{i.stopPropagation();const l=prompt("Discharge note (optional)");I(t.id,l),g(t.id,{admitted:!1,dischargeNote:l}),o===t.id&&$(A=>({...A,admitted:!1,dischargeNote:l}))},children:"Discharge"}):e.jsx("button",{className:"tab-btn",onClick:i=>{i.stopPropagation();const l=prompt("Admission reason (optional)");m(t.id,{reason:l}),g(t.id,{admitted:!0,admissionMeta:{reason:l},admittedAt:new Date().toISOString()}),o===t.id&&$(A=>({...A,admitted:!0,admissionMeta:{reason:l},admittedAt:new Date().toISOString()}))},children:"Admit"})]})]})]},t.id))}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("strong",{children:"Import from animals"}),e.jsx("div",{style:{maxHeight:160,overflow:"auto"},children:u.map(t=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:4},children:[e.jsxs("div",{children:[t.name," ",e.jsx("small",{children:t.tag})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{const i={id:R("p-"),animalId:t.id,name:t.name||"",tag:t.tag||"",owner:t.owner||{},createdAt:new Date().toISOString(),notes:[],vaccinations:[],medications:[],surgeries:[],communications:[],attachments:[]};d(i),y(i.id),L(!0)},children:"Import"})})]},t.id))})]})]}),e.jsx("div",{style:{flex:1},children:o?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h4",{children:h.name||"(unnamed)"}),e.jsxs("div",{className:"muted",style:{fontSize:12},children:[h.tag||""," ",h.animalId?`• animal ${h.animalId}`:""]}),h.admitted?e.jsxs("div",{style:{marginTop:6},children:[e.jsx("span",{className:"flag",children:"Admitted"})," ",e.jsx("small",{className:"muted",children:h.admittedAt?new Date(h.admittedAt).toLocaleString():""})]}):null]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>L(t=>!t),children:S?"Cancel":"Edit"}),e.jsx("button",{onClick:()=>{window.confirm("Remove patient?")&&(x(o),y(null))},style:{marginLeft:8},children:"Delete"})]})]}),S?e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block"},children:["Name",e.jsx("input",{value:h.name||"",onChange:t=>{$({...h,name:t.target.value}),o&&g(o,{name:t.target.value})}})]}),e.jsxs("label",{style:{display:"block"},children:["Tag",e.jsx("input",{value:h.tag||"",onChange:t=>{$({...h,tag:t.target.value}),o&&g(o,{tag:t.target.value})}})]}),e.jsxs("label",{style:{display:"block"},children:["Owner",e.jsx("input",{value:h.owner?.name||"",onChange:t=>{$({...h,owner:{...h.owner||{},name:t.target.value}}),o&&g(o,{owner:{...h.owner||{},name:t.target.value}})}})]}),e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{onClick:()=>{_()},children:"Save"})}),e.jsx("div",{style:{marginTop:8},children:h.admitted?e.jsx("button",{className:"tab-btn",onClick:()=>{const t=prompt("Discharge note (optional)");I(o,t),g(o,{admitted:!1,dischargeNote:t}),$(i=>({...i,admitted:!1,dischargeNote:t}))},children:"Discharge"}):e.jsx("button",{className:"tab-btn",onClick:()=>{const t=prompt("Admission reason (optional)");m(o,{reason:t}),g(o,{admitted:!0,admissionMeta:{reason:t}}),$(i=>({...i,admitted:!0,admissionMeta:{reason:t},admittedAt:new Date().toISOString()}))},children:"Admit"})})]}):e.jsxs("div",{children:[e.jsxs("section",{children:[e.jsx("strong",{children:"Notes"}),e.jsx("ul",{children:(h.notes||[]).map(t=>e.jsxs("li",{children:[t.subject||t.text," ",e.jsxs("small",{children:["(",new Date(t.createdAt).toLocaleString(),")"]})]},t.id))})]}),e.jsxs("section",{style:{marginTop:8},children:[e.jsx("strong",{children:"Vaccinations"}),e.jsx(de,{items:h.vaccinations||[]}),e.jsx(se,{onAdd:t=>{N(o,"vaccinations",t),$(i=>({...i,vaccinations:[...i.vaccinations||[],{id:R("v-"),...t,createdAt:new Date().toISOString()}]}))}})]}),e.jsxs("section",{style:{marginTop:8},children:[e.jsx("strong",{children:"Vitals & Weights"}),e.jsxs("div",{className:"vitals-row",children:[e.jsxs("div",{className:"vitals-item",children:["Latest: ",(h.vitals||[]).slice(-1)[0]?.weight?`${(h.vitals||[]).slice(-1)[0].weight} kg`:"—"]}),e.jsxs("div",{className:"vitals-item",children:["Temp: ",(h.vitals||[]).slice(-1)[0]?.temp||"—"]}),e.jsxs("div",{className:"vitals-item",children:["HR: ",(h.vitals||[]).slice(-1)[0]?.hr||"—"]})]}),e.jsx(re,{onAdd:t=>{N(o,"vitals",t),$(i=>({...i,vitals:[...i.vitals||[],{id:R("vt-"),...t,createdAt:new Date().toISOString()}]}))}}),e.jsx(ce,{items:h.vitals||[]})]}),e.jsxs("section",{style:{marginTop:8},children:[e.jsx("strong",{children:"Status"}),e.jsxs("div",{style:{marginTop:6},children:[e.jsx("button",{className:`tab-btn ${h.flags?.injured,""}`,onClick:()=>{toggleFlag(o,"injured"),g(o,{flags:{...h.flags||{},injured:!h.flags?.injured}}),$(t=>({...t,flags:{...t.flags||{},injured:!t.flags?.injured}}))},children:h.flags?.injured?"Unmark injured":"Mark injured"}),e.jsx("button",{className:"tab-btn",onClick:()=>{toggleFlag(o,"isolated"),g(o,{flags:{...h.flags||{},isolated:!h.flags?.isolated}}),$(t=>({...t,flags:{...t.flags||{},isolated:!t.flags?.isolated}}))},style:{marginLeft:8},children:h.flags?.isolated?"Unmark isolated":"Mark isolated"})]})]}),e.jsxs("section",{style:{marginTop:8},children:[e.jsx("strong",{children:"Medications"}),e.jsx(oe,{items:h.medications||[]}),e.jsx(le,{onAdd:t=>{N(o,"medications",t),$(i=>({...i,medications:[...i.medications||[],{id:R("m-"),...t,createdAt:new Date().toISOString()}]}))}})]}),e.jsxs("section",{style:{marginTop:8},children:[e.jsx("strong",{children:"Attachments"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:(h.attachments||[]).map(t=>e.jsxs("div",{style:{width:140},children:[e.jsx("div",{style:{fontSize:11},children:t.filename}),e.jsx("a",{href:t.dataUrl,target:"_blank",rel:"noreferrer",children:"Open"})]},t.id))}),e.jsxs("label",{style:{display:"block",marginTop:8},children:["Add file",e.jsx("input",{type:"file",onChange:t=>{const i=t.target.files[0];i&&f(o,i),t.target.value=""}})]})]})]})]}):e.jsx("div",{className:"muted",children:"Select a patient"})})]})}function se({onAdd:r}){const[d,g]=p.useState(""),[x,f]=p.useState(""),[v,N]=p.useState("");return e.jsx("form",{onSubmit:m=>{m.preventDefault(),r({vaccine:d,date:x,lot:v}),g(""),f(""),N("")},style:{marginTop:8},children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("input",{placeholder:"Vaccine",value:d,onChange:m=>g(m.target.value)}),e.jsx("input",{type:"date",value:x,onChange:m=>f(m.target.value)}),e.jsx("input",{placeholder:"Lot",value:v,onChange:m=>N(m.target.value)}),e.jsx("button",{type:"submit",children:"Add"})]})})}function de({items:r=[]}){return e.jsx("ul",{children:r.map(d=>e.jsxs("li",{children:[d.date||d.createdAt," — ",d.vaccine," ",d.lot?`(lot ${d.lot})`:""]},d.id))})}function le({onAdd:r}){const[d,g]=p.useState(""),[x,f]=p.useState("");return e.jsx("form",{onSubmit:v=>{v.preventDefault(),r({drug:d,dose:x}),g(""),f("")},style:{marginTop:8},children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("input",{placeholder:"Drug",value:d,onChange:v=>g(v.target.value)}),e.jsx("input",{placeholder:"Dose",value:x,onChange:v=>f(v.target.value)}),e.jsx("button",{type:"submit",children:"Add"})]})})}function oe({items:r=[]}){return e.jsx("ul",{children:r.map(d=>e.jsxs("li",{children:[d.drug," — ",d.dose]},d.id))})}function re({onAdd:r}){const[d,g]=p.useState(""),[x,f]=p.useState(""),[v,N]=p.useState(""),[m,I]=p.useState("");return e.jsx("form",{onSubmit:u=>{u.preventDefault(),r({weight:d?Number(d):void 0,temp:x||void 0,hr:v||void 0,notes:m}),g(""),f(""),N(""),I("")},style:{marginTop:8},children:e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{placeholder:"Weight (kg)",value:d,onChange:u=>g(u.target.value),style:{width:100}}),e.jsx("input",{placeholder:"Temp (°C)",value:x,onChange:u=>f(u.target.value),style:{width:110}}),e.jsx("input",{placeholder:"HR",value:v,onChange:u=>N(u.target.value),style:{width:80}}),e.jsx("input",{placeholder:"Notes",value:m,onChange:u=>I(u.target.value),style:{flex:1}}),e.jsx("button",{type:"submit",children:"Add"})]})})}function ce({items:r=[]}){return!r||r.length===0?e.jsx("div",{className:"muted",children:"No vitals recorded"}):e.jsx("ul",{children:r.slice().reverse().map(d=>e.jsxs("li",{children:[d.createdAt?new Date(d.createdAt).toLocaleString():""," — ",d.weight?`${d.weight} kg`:""," ",d.temp?`• ${d.temp}°C`:""," ",d.hr?`• ${d.hr} bpm`:""," ",d.notes?`• ${d.notes}`:""]},d.id))})}function me({patients:r=[],appointments:d=[],createAppointment:g}){const[x,f]=p.useState(""),[v,N]=p.useState(""),[m,I]=p.useState("");return e.jsxs("div",{children:[e.jsx("form",{onSubmit:u=>{u.preventDefault(),g({patientId:x,when:v,reason:m,createdAt:new Date().toISOString(),status:"Scheduled"}),f(""),N(""),I("")},children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("select",{value:x,onChange:u=>f(u.target.value),children:[e.jsx("option",{value:"",children:"Select patient"}),r.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]}),e.jsx("input",{type:"datetime-local",value:v,onChange:u=>N(u.target.value)}),e.jsx("input",{placeholder:"Reason",value:m,onChange:u=>I(u.target.value)}),e.jsx("button",{type:"submit",children:"Create"})]})}),e.jsx("div",{style:{marginTop:8},children:d.map(u=>e.jsxs("div",{children:[(r.find(o=>o.id===u.patientId)||{}).name||u.patientId," — ",u.when||u.createdAt," — ",u.status]},u.id))})]})}function ue({patients:r=[],prescriptions:d=[],addPrescription:g,inventory:x=[]}){const[f,v]=p.useState(""),[N,m]=p.useState(""),[I,u]=p.useState("");return e.jsxs("div",{children:[e.jsx("form",{onSubmit:o=>{o.preventDefault(),g({patientId:f,drug:N,dose:I}),m(""),u("")},children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("select",{value:f,onChange:o=>v(o.target.value),children:[e.jsx("option",{value:"",children:"Select patient"}),r.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]}),e.jsx("input",{placeholder:"Drug",value:N,onChange:o=>m(o.target.value)}),e.jsx("input",{placeholder:"Dose",value:I,onChange:o=>u(o.target.value)}),e.jsx("button",{type:"submit",children:"Prescribe"})]})}),e.jsx("ul",{children:d.map(o=>e.jsxs("li",{children:[(r.find(y=>y.id===o.patientId)||{}).name||o.patientId," — ",o.drug," — ",o.dose]},o.id))})]})}function he({inventory:r=[],addInventory:d,adjustInventory:g}){const[x,f]=p.useState(""),[v,N]=p.useState(0);return e.jsxs("div",{children:[e.jsxs("form",{onSubmit:m=>{m.preventDefault(),d({name:x,qty:v}),f(""),N(0)},children:[e.jsx("input",{placeholder:"Item name",value:x,onChange:m=>f(m.target.value)}),e.jsx("input",{type:"number",value:v,onChange:m=>N(m.target.value)}),e.jsx("button",{type:"submit",children:"Add"})]}),e.jsx("ul",{children:r.map(m=>e.jsxs("li",{children:[m.name," — ",m.qty," ",e.jsx("button",{onClick:()=>g(m.id,-1),children:"-"}),e.jsx("button",{onClick:()=>g(m.id,1),children:"+"})]},m.id))})]})}function pe({patients:r=[],billing:d=[],charge:g,setInvoicePaid:x,generateInvoice:f}){const[v,N]=p.useState(""),[m,I]=p.useState(""),[u,o]=p.useState("");return e.jsxs("div",{children:[e.jsx("form",{onSubmit:y=>{y.preventDefault(),g(v,m,u),I(""),o("")},children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("select",{value:v,onChange:y=>N(y.target.value),children:[e.jsx("option",{value:"",children:"Select patient"}),r.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]}),e.jsx("input",{placeholder:"Description",value:m,onChange:y=>I(y.target.value)}),e.jsx("input",{placeholder:"Amount",type:"number",value:u,onChange:y=>o(y.target.value)}),e.jsx("button",{type:"submit",children:"Charge"})]})}),e.jsx("ul",{children:d.map(y=>e.jsxs("li",{children:[y.desc," — $",Number(y.amount).toFixed(2)," — ",(r.find(S=>S.id===y.patientId)||{}).name||y.patientId," — ",y.paid?"Paid":e.jsx("button",{onClick:()=>x(y.id,!0),children:"Mark paid"})," ",e.jsx("button",{onClick:()=>f(y.patientId),children:"Invoice"})]},y.id))})]})}function ge({patients:r=[],appointments:d=[],prescriptions:g=[],inventory:x=[],billing:f=[],downloadJson:v,downloadPatientCsv:N}){function m(t){const i=t||{},l=a=>String(a??""),A=d.filter(a=>a.patientId===i.id),D=g.filter(a=>a.patientId===i.id),H=f.filter(a=>a.patientId===i.id),T=(a,c,b)=>`
<h3>${a} (${c.length})</h3>
${c.length?'<table border="0" style="width:100%;border-collapse:collapse">'+c.map(b).join("")+"</table>":'<div class="muted">No records</div>'}`,q=T("Notes",i.notes||[],a=>`<tr><td style="padding:6px;border:1px solid #eee"><strong>${l(a.createdAt||a.date||"")}</strong><div>${l(a.subjective||"")}</div><div>${l(a.objective||"")}</div><div>${l(a.assessment||"")}</div><div>${l(a.plan||"")}</div></td></tr>`),W=T("Vitals",i.vitals||[],a=>`<tr><td style="padding:6px;border:1px solid #eee">${l(a.createdAt||a.date||"")} — Weight: ${l(a.weight)} kg • Temp: ${l(a.temp)} °C • HR: ${l(a.hr)} • ${l(a.notes||"")}</td></tr>`),C=T("Vaccinations",i.vaccinations||[],a=>`<tr><td style="padding:6px;border:1px solid #eee">${l(a.date||a.createdAt||"")} — ${l(a.vaccine||"")} ${a.lot?" (lot "+l(a.lot)+")":""}</td></tr>`),w=T("Medications",i.medications||[],a=>`<tr><td style="padding:6px;border:1px solid #eee">${l(a.createdAt||a.date||"")} — ${l(a.drug||a.name||"")} — ${l(a.dose||"")}</td></tr>`),E=T("Attachments",i.attachments||[],a=>`<tr><td style="padding:6px;border:1px solid #eee">${l(a.filename||"file")} — ${l(a.createdAt||"")}<div>${a.dataUrl?`<img src="${a.dataUrl}" style="max-width:320px;display:block;margin-top:6px"/>`:""}</div></td></tr>`),V=T("Appointments",A,a=>`<tr><td style="padding:6px;border:1px solid #eee">${l(a.when||a.createdAt||"")} — ${l(a.reason||"")} — ${l(a.status||"")}</td></tr>`),F=T("Prescriptions",D,a=>`<tr><td style="padding:6px;border:1px solid #eee">${l(a.createdAt||"")} — ${l(a.drug||"")} — ${l(a.dose||"")}</td></tr>`),K=T("Billing",H,a=>`<tr><td style="padding:6px;border:1px solid #eee">${l(a.createdAt||"")} — ${l(a.desc||"")} — ${l(a.amount||"")} — ${a.paid?"Paid":"Unpaid"}</td></tr>`),n=`
      <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #000; padding-bottom: 15px;">
        <h1 style="margin: 0; font-size: 28pt; letter-spacing: 2px;">JR FARM</h1>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
          <div style="flex: 1;"></div>
          <div style="flex: 2; text-align: center;">
            <p style="margin: 5px 0; font-size: 11pt;">Patient Health Record</p>
            <p style="margin: 5px 0; font-size: 10pt; color: #555;">Date: ${new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}</p>
          </div>
          <div style="flex: 1; text-align: right; font-size: 9pt; font-style: italic; color: #666;">
            Made by<br/>Dr. Devin Omwenga
          </div>
        </div>
      </div>`;return`<!doctype html><html><head><meta charset="utf-8"><title>Full record - ${l(i.name||i.id||"patient")}</title><style>body{font-family:Arial,Helvetica,sans-serif;padding:18px;color:#111}h1{margin-bottom:6px}h2{margin:0}h3{margin-top:18px;color:#2b8c3e}table{margin-top:6px}td{vertical-align:top}.muted{color:#666}</style></head><body>${n}<h1>${l(i.name||"(unnamed)")}</h1><div><strong>ID:</strong> ${l(i.id||"")}</div><div><strong>Tag:</strong> ${l(i.tag||"")}</div><div><strong>Owner:</strong> ${l(i.owner?.name||"")}</div><div><strong>Created:</strong> ${l(i.createdAt||"")}</div>${q}${W}${C}${w}${E}${V}${F}${K}</body></html>`}function I(t){const i=r.find(T=>T.id===t);if(!i)return alert("Patient not found");const l=m(i),A=new Blob([l],{type:"application/msword"}),D=URL.createObjectURL(A),H=document.createElement("a");H.href=D,H.download=`patient-${t}.doc`,document.body.appendChild(H),H.click(),H.remove(),URL.revokeObjectURL(D)}function u(t){const i=r.find(D=>D.id===t);if(!i)return alert("Patient not found");const l=m(i),A=window.open("","_blank");if(!A)return alert("Popup blocked — allow popups to preview the report");A.document.open(),A.document.write(l),A.document.close()}function o(){const t=`<!doctype html><html><head><meta charset="utf-8"><title>Full health dataset</title></head><body>${r.map(D=>m(D)).join('<div style="page-break-after:always"></div>')}</body></html>`,i=new Blob([t],{type:"application/msword"}),l=URL.createObjectURL(i),A=document.createElement("a");A.href=l,A.download="full-health-records.doc",document.body.appendChild(A),A.click(),A.remove(),URL.revokeObjectURL(l)}function y(t,i="export.csv"){try{const l=C=>'"'+String(C??"").replace(/"/g,'""')+'"';let A=[],D=[];S==="vitals"?(A=["date","patientId","patientName","weight","temp","hr","notes"],D=t.map(C=>{const w=C.data||{},E=r.find(F=>F.id===C.patientId)||{};return[w.createdAt||w.date||"",C.patientId||"",E.name||"",w.weight??"",w.temp??"",w.hr??"",w.notes||""]})):S==="vaccinations"?(A=["date","patientId","patientName","vaccine","lot","notes"],D=t.map(C=>{const w=C.data||{},E=r.find(F=>F.id===C.patientId)||{};return[w.createdAt||w.date||"",C.patientId||"",E.name||"",w.vaccine||w.vaccineName||"",w.lot||"",w.notes||""]})):S==="medications"?(A=["date","patientId","patientName","drug","dose","notes"],D=t.map(C=>{const w=C.data||{},E=r.find(F=>F.id===C.patientId)||{};return[w.createdAt||w.date||"",C.patientId||"",E.name||"",w.drug||w.name||"",w.dose||"",w.notes||""]})):S==="appointments"?(A=["date","patientId","patientName","when","reason","status"],D=t.map(C=>{const w=C.data||{},E=r.find(F=>F.id===C.patientId)||{},V=w.when||w.createdAt||"";return[w.createdAt||"",C.patientId||"",E.name||"",V,w.reason||"",w.status||""]})):S==="billing"?(A=["date","patientId","patientName","desc","amount","paid"],D=t.map(C=>{const w=C.data||{},E=r.find(V=>V.id===C.patientId)||{};return[w.createdAt||"",C.patientId||"",E.name||"",w.desc||"",w.amount??"",w.paid?"yes":"no"]})):(A=["id","patientId","type","data"],D=t.map(C=>[C.id||"",C.patientId||"",C.type||"",JSON.stringify(C.data||{})]));const H=[A,...D].map(C=>C.map(l).join(",")).join(`
`),T=new Blob([H],{type:"text/csv"}),q=URL.createObjectURL(T),W=document.createElement("a");W.href=q,W.download=i,document.body.appendChild(W),W.click(),W.remove(),URL.revokeObjectURL(q)}catch(l){console.error("csv export failed",l)}}const[S,L]=p.useState("patients"),[h,$]=p.useState(""),[P,J]=p.useState(null),_=[{id:"patients",label:"Patients / Records"},{id:"appointments",label:"Appointments"},{id:"prescriptions",label:"Prescriptions"},{id:"vitals",label:"Vitals"},{id:"vaccinations",label:"Vaccinations"},{id:"medications",label:"Medications"},{id:"attachments",label:"Attachments"},{id:"inventory",label:"Inventory"},{id:"billing",label:"Billing"}];function z(){if(S==="patients")return r.map(i=>({id:i.id,patientId:i.id,data:i,type:"patient"}));if(S==="appointments")return d.map(i=>({id:i.id,patientId:i.patientId,data:i,type:"appointment"}));if(S==="prescriptions")return g.map(i=>({id:i.id,patientId:i.patientId,data:i,type:"prescription"}));if(S==="inventory")return x.map(i=>({id:i.id,data:i,type:"inventory"}));if(S==="billing")return f.map(i=>({id:i.id,patientId:i.patientId,data:i,type:"billing"}));const t=[];return r.forEach(i=>{(!h||h===i.id)&&(S==="vitals"&&(i.vitals||[]).forEach(l=>t.push({id:l.id,patientId:i.id,data:l,type:"vital"})),S==="vaccinations"&&(i.vaccinations||[]).forEach(l=>t.push({id:l.id,patientId:i.id,data:l,type:"vaccination"})),S==="medications"&&(i.medications||[]).forEach(l=>t.push({id:l.id,patientId:i.id,data:l,type:"medication"})),S==="attachments"&&(i.attachments||[]).forEach(l=>t.push({id:l.id,patientId:i.id,data:l,type:"attachment"})))}),t}const U=z();return e.jsxs("div",{children:[e.jsx("h4",{children:"Reports"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[e.jsx("select",{value:S,onChange:t=>L(t.target.value),children:_.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))}),e.jsxs("select",{value:h,onChange:t=>$(t.target.value),children:[e.jsx("option",{value:"",children:"All patients"}),r.map(t=>e.jsx("option",{value:t.id,children:t.name||t.tag||t.id},t.id))]}),h?e.jsx("button",{className:"tab-btn",onClick:()=>N(h),children:"Download patient CSV"}):null,e.jsxs("button",{onClick:()=>v(U,`${S}-export.json`),children:["Download visible JSON (",U.length,")"]}),e.jsx("button",{onClick:()=>y(U,`${S}-export.csv`),className:"tab-btn",children:"Download section CSV"}),e.jsx("button",{onClick:()=>v(r,"full-health-records.json"),children:"Download full health dataset"}),e.jsx("button",{className:"tab-btn",onClick:()=>o(),title:"Download a combined .doc of all patients",children:"Download all patients (.doc)"}),h?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"tab-btn",onClick:()=>u(h),title:"Open full patient report in a new window",children:"Open full report"}),e.jsx("button",{className:"tab-btn",onClick:()=>I(h),title:"Download full patient report as .doc",children:"Download .doc"})]}):null]}),e.jsx("div",{children:U.length===0?e.jsx("div",{className:"muted",children:"No records for selected section."}):U.map(t=>e.jsxs("div",{className:"card",style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:t.type==="patient"?t.data.name||"(unnamed)":`${t.type} — ${t.data.id||""}`}),e.jsxs("div",{className:"muted",children:["Patient: ",(r.find(i=>i.id===t.patientId)||{}).name||t.patientId]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>J(P===t.id?null:t.id),className:"tab-btn",children:P===t.id?"Hide":"View"}),e.jsx("button",{onClick:()=>v(t.data,`${t.type}-${t.id}.json`),className:"tab-btn",style:{marginLeft:8},children:"Download"}),t.type==="patient"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>v(t.data,`patient-full-${t.id}.json`),className:"tab-btn",style:{marginLeft:8},children:"Download full record"}),e.jsx("button",{onClick:()=>u(t.id),className:"tab-btn",style:{marginLeft:8},children:"Open full report"}),e.jsx("button",{onClick:()=>I(t.id),className:"tab-btn",style:{marginLeft:8},children:"Download .doc"})]})]})]}),P===t.id&&e.jsx("pre",{style:{whiteSpace:"pre-wrap",marginTop:8,maxHeight:300,overflow:"auto"},children:JSON.stringify(t.data,null,2)})]},t.id))})]})}const ve=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"}));export{ae as H,ve as a,ne as f,fe as u};
