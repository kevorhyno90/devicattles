import{j as e,r as y}from"./index-CeDgDi5r.js";import{f as F}from"./currency-DPL_p1aK.js";import"./vendor-react-CqO7gtIP.js";import"./lib-core-XQuPJE47.js";import"./lib-export-Dp5-osfT.js";import"./lib-notifications-DRlqN2Ug.js";import"./lib-integration-BX7JWOcy.js";import"./vendor-firebase-DPzZ0AXH.js";function D({data:o,width:h=600,height:d=300,title:j="",xLabel:v="",yLabel:g="",color:p="#059669"}){if(!o||o.length===0)return e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#6b7280"},children:"No data available"});const i={top:40,right:40,bottom:50,left:60},W=h-i.left-i.right,m=d-i.top-i.bottom,S=o.map(s=>s.value),l=Math.max(...S,0),r=Math.min(...S,0),u=l-r||1,f=o.map((s,c)=>{const b=i.left+c/(o.length-1||1)*W,k=i.top+m-(s.value-r)/u*m;return{x:b,y:k,label:s.label,value:s.value}}),M=f.map((s,c)=>`${c===0?"M":"L"} ${s.x} ${s.y}`).join(" ");return e.jsxs("div",{style:{marginBottom:"20px"},children:[j&&e.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:"16px",fontWeight:"600"},children:j}),e.jsxs("svg",{width:h,height:d,style:{border:"1px solid #e5e7eb",borderRadius:"8px",background:"white"},children:[[0,.25,.5,.75,1].map((s,c)=>{const b=i.top+m*s,k=l-u*s;return e.jsxs("g",{children:[e.jsx("line",{x1:i.left,y1:b,x2:h-i.right,y2:b,stroke:"#e5e7eb",strokeWidth:"1"}),e.jsx("text",{x:i.left-10,y:b+5,textAnchor:"end",fontSize:"12",fill:"#6b7280",children:k.toFixed(0)})]},c)}),f.map((s,c)=>o.length>10&&c%Math.ceil(o.length/10)!==0&&c!==o.length-1?null:e.jsx("text",{x:s.x,y:d-i.bottom+20,textAnchor:"middle",fontSize:"11",fill:"#6b7280",children:s.label},c)),e.jsx("path",{d:`${M} L ${f[f.length-1].x} ${d-i.bottom} L ${i.left} ${d-i.bottom} Z`,fill:p,fillOpacity:"0.1"}),e.jsx("path",{d:M,fill:"none",stroke:p,strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),f.map((s,c)=>e.jsxs("g",{children:[e.jsx("circle",{cx:s.x,cy:s.y,r:"4",fill:"white",stroke:p,strokeWidth:"2"}),e.jsx("title",{children:`${s.label}: ${s.value}`})]},c)),g&&e.jsx("text",{x:15,y:d/2,textAnchor:"middle",fontSize:"13",fill:"#374151",fontWeight:"600",transform:`rotate(-90, 15, ${d/2})`,children:g}),v&&e.jsx("text",{x:h/2,y:d-10,textAnchor:"middle",fontSize:"13",fill:"#374151",fontWeight:"600",children:v})]})]})}function O({data:o,width:h=300,height:d=300,title:j=""}){if(!o||o.length===0)return e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#6b7280"},children:"No data available"});const v=o.reduce((l,r)=>l+r.value,0),g=h/2,p=d/2,i=Math.min(h,d)/2-40,W=["#059669","#3b82f6","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"];let m=-90;const S=o.map((l,r)=>{const u=l.value/v*360,f=m*(Math.PI/180),M=(m+u)*(Math.PI/180),s=g+i*Math.cos(f),c=p+i*Math.sin(f),b=g+i*Math.cos(M),k=p+i*Math.sin(M),z=u>180?1:0,$=`M ${g} ${p} L ${s} ${c} A ${i} ${i} 0 ${z} 1 ${b} ${k} Z`,A=(m+u/2)*(Math.PI/180),L=i*.7,T=g+L*Math.cos(A),N=p+L*Math.sin(A);return m+=u,{path:$,color:W[r%W.length],label:l.label,value:l.value,percentage:(l.value/v*100).toFixed(1),labelX:T,labelY:N}});return e.jsxs("div",{style:{marginBottom:"20px"},children:[j&&e.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:"16px",fontWeight:"600"},children:j}),e.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[e.jsx("svg",{width:h,height:d,children:S.map((l,r)=>e.jsxs("g",{children:[e.jsx("path",{d:l.path,fill:l.color,stroke:"white",strokeWidth:"2"}),e.jsxs("text",{x:l.labelX,y:l.labelY,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"600",children:[l.percentage,"%"]})]},r))}),e.jsx("div",{style:{flex:"1",minWidth:"150px"},children:S.map((l,r)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"16px",height:"16px",background:l.color,borderRadius:"4px"}}),e.jsxs("div",{style:{fontSize:"13px"},children:[e.jsx("strong",{children:l.label}),": ",l.value," (",l.percentage,"%)"]})]},r))})]})]})}function V(){const[o,h]=y.useState([]),[d,j]=y.useState([]),[v,g]=y.useState([]),[p,i]=y.useState([]),[W,m]=y.useState([]),[S,l]=y.useState("6months"),[r,u]=y.useState("all");y.useEffect(()=>{f()},[]);function f(){try{h(JSON.parse(localStorage.getItem("cattalytics:animals")||"[]")),j(JSON.parse(localStorage.getItem("devinsfarm:milkYield")||"[]")),g(JSON.parse(localStorage.getItem("devinsfarm:measurements")||"[]")),i(JSON.parse(localStorage.getItem("devinsfarm:transactions")||"[]")),m(JSON.parse(localStorage.getItem("devinsfarm:crops")||"[]"))}catch(t){console.error("Error loading data:",t)}}function M(){const t=r==="all"?d:d.filter(x=>x.animalId===r),n={};return t.forEach(x=>{const w=x.date||x.milkingDate;if(!w)return;const I=w.substring(0,7);n[I]||(n[I]={total:0,count:0}),n[I].total+=parseFloat(x.quantity||x.totalQuantity||0),n[I].count++}),Object.keys(n).sort().slice(-12).map(x=>({label:x,value:parseFloat(n[x].total.toFixed(1))}))}function s(){return r==="all"?[]:v.filter(n=>n.animalId===r).sort((n,a)=>new Date(n.date)-new Date(a.date)).map(n=>({label:new Date(n.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),value:parseFloat(n.weight||0)}))}function c(){const t={},n=new Date;for(let a=11;a>=0;a--){const w=new Date(n.getFullYear(),n.getMonth()-a,1).toISOString().substring(0,7);t[w]={income:0,expense:0}}return p.forEach(a=>{if(!a.date)return;const x=a.date.substring(0,7);if(!t[x])return;const w=parseFloat(a.amount||0);a.type==="income"?t[x].income+=w:t[x].expense+=w}),Object.keys(t).sort().map(a=>({month:a,income:t[a].income,expense:t[a].expense,profit:t[a].income-t[a].expense}))}function b(){const t={};return o.forEach(n=>{const a=n.breed||"Unknown";t[a]=(t[a]||0)+1}),Object.keys(t).map(n=>({label:n,value:t[n]}))}function k(){const t={};return o.forEach(n=>{const a=n.status||"Unknown";t[a]=(t[a]||0)+1}),Object.keys(t).map(n=>({label:n,value:t[n]}))}const z=M(),$=s(),A=c(),L=b(),T=k(),N=A.map(t=>({label:t.month,value:t.income/1e3})),P=A.map(t=>({label:t.month,value:t.expense/1e3})),R=A.map(t=>({label:t.month,value:t.profit/1e3}));return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"700",marginBottom:"8px"},children:"ðŸ“Š Advanced Analytics"}),e.jsx("p",{style:{color:"#6b7280",margin:0},children:"Visual insights and trends for your farm data"})]}),e.jsx("div",{className:"card",style:{padding:"16px",marginBottom:"24px"},children:e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"14px",fontWeight:"500"},children:["Period:",e.jsxs("select",{value:S,onChange:t=>l(t.target.value),style:{marginLeft:"8px",padding:"6px 12px",borderRadius:"6px",border:"1px solid #d1d5db"},children:[e.jsx("option",{value:"3months",children:"Last 3 Months"}),e.jsx("option",{value:"6months",children:"Last 6 Months"}),e.jsx("option",{value:"12months",children:"Last 12 Months"}),e.jsx("option",{value:"all",children:"All Time"})]})]}),e.jsxs("label",{style:{fontSize:"14px",fontWeight:"500"},children:["Animal:",e.jsxs("select",{value:r,onChange:t=>u(t.target.value),style:{marginLeft:"8px",padding:"6px 12px",borderRadius:"6px",border:"1px solid #d1d5db"},children:[e.jsx("option",{value:"all",children:"All Animals"}),o.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.tag,")"]},t.id))]})]})]})}),e.jsxs("div",{style:{display:"grid",gap:"24px"},children:[z.length>0&&e.jsx("div",{className:"card",style:{padding:"20px"},children:e.jsx(D,{data:z,title:"ðŸ¥› Milk Production Trend",xLabel:"Month",yLabel:"Liters",color:"#059669",width:Math.min(window.innerWidth-100,800),height:300})}),r!=="all"&&$.length>0&&e.jsx("div",{className:"card",style:{padding:"20px"},children:e.jsx(D,{data:$,title:`ðŸ“ˆ Weight Growth: ${o.find(t=>t.id===r)?.name||""}`,xLabel:"Date",yLabel:"Weight (kg)",color:"#3b82f6",width:Math.min(window.innerWidth-100,800),height:300})}),e.jsxs("div",{className:"card",style:{padding:"20px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"ðŸ’° Financial Trends (KSH '000)"}),e.jsxs("div",{style:{display:"grid",gap:"24px"},children:[e.jsx(D,{data:N,title:"Income Over Time",xLabel:"Month",yLabel:"KSH (Thousands)",color:"#10b981",width:Math.min(window.innerWidth-140,700),height:250}),e.jsx(D,{data:P,title:"Expenses Over Time",xLabel:"Month",yLabel:"KSH (Thousands)",color:"#ef4444",width:Math.min(window.innerWidth-140,700),height:250}),e.jsx(D,{data:R,title:"Net Profit/Loss",xLabel:"Month",yLabel:"KSH (Thousands)",color:"#8b5cf6",width:Math.min(window.innerWidth-140,700),height:250})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(350px, 1fr))",gap:"24px"},children:[L.length>0&&e.jsx("div",{className:"card",style:{padding:"20px"},children:e.jsx(O,{data:L,title:"ðŸ„ Animals by Breed",width:350,height:300})}),T.length>0&&e.jsx("div",{className:"card",style:{padding:"20px"},children:e.jsx(O,{data:T,title:"ðŸ“Š Animals by Status",width:350,height:300})})]}),e.jsxs("div",{className:"card",style:{padding:"20px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"ðŸ“ˆ Key Metrics"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px"},children:[e.jsxs("div",{style:{padding:"16px",background:"#f0fdf4",borderRadius:"8px",border:"1px solid #bbf7d0"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:"#059669"},children:o.filter(t=>t.status==="Active").length}),e.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginTop:"4px"},children:"Active Animals"})]}),e.jsxs("div",{style:{padding:"16px",background:"#eff6ff",borderRadius:"8px",border:"1px solid #bfdbfe"},children:[e.jsxs("div",{style:{fontSize:"24px",fontWeight:"700",color:"#3b82f6"},children:[d.reduce((t,n)=>t+parseFloat(n.quantity||n.totalQuantity||0),0).toFixed(0),"L"]}),e.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginTop:"4px"},children:"Total Milk Produced"})]}),e.jsxs("div",{style:{padding:"16px",background:"#fef3c7",borderRadius:"8px",border:"1px solid #fde68a"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:"#f59e0b"},children:F(p.filter(t=>t.type==="income").reduce((t,n)=>t+parseFloat(n.amount||0),0))}),e.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginTop:"4px"},children:"Total Income"})]}),e.jsxs("div",{style:{padding:"16px",background:"#fef2f2",borderRadius:"8px",border:"1px solid #fecaca"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:"#ef4444"},children:F(p.filter(t=>t.type==="expense").reduce((t,n)=>t+parseFloat(n.amount||0),0))}),e.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginTop:"4px"},children:"Total Expenses"})]})]})]})]})]})}export{V as default};
